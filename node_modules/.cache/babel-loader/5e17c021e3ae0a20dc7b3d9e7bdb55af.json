{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { Engine } from \"../Engines/engine\";\nimport { VertexBuffer } from \"../Meshes/buffer\";\nimport { InternalTexture, InternalTextureSource } from \"../Materials/Textures/internalTexture\";\nimport { Texture } from \"../Materials/Textures/texture\";\nimport { DataBuffer } from '../Meshes/dataBuffer';\nimport { Tools } from \"../Misc/tools\";\nimport { EnvironmentTextureTools } from \"../Misc/environmentTextureTools\";\nimport { RenderTargetCreationOptions } from \"../Materials/Textures/renderTargetCreationOptions\";\nimport { Logger } from \"../Misc/logger\";\nimport { ThinEngine } from './thinEngine';\nimport { EngineStore } from './engineStore';\nimport { ShaderCodeInliner } from \"./Processors/shaderCodeInliner\";\nimport { WebGL2ShaderProcessor } from '../Engines/WebGL/webGL2ShaderProcessors';\n\nvar NativePipelineContext =\n/** @class */\nfunction () {\n  function NativePipelineContext() {\n    // TODO: async should be true?\n    this.isAsync = false;\n    this.isReady = false;\n  }\n\n  NativePipelineContext.prototype._getVertexShaderCode = function () {\n    return null;\n  };\n\n  NativePipelineContext.prototype._getFragmentShaderCode = function () {\n    return null;\n  }; // TODO: what should this do?\n\n\n  NativePipelineContext.prototype._handlesSpectorRebuildCallback = function (onCompiled) {\n    throw new Error(\"Not implemented\");\n  };\n\n  return NativePipelineContext;\n}();\n/**\r\n * Container for accessors for natively-stored mesh data buffers.\r\n */\n\n\nvar NativeDataBuffer =\n/** @class */\nfunction (_super) {\n  __extends(NativeDataBuffer, _super);\n\n  function NativeDataBuffer() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  return NativeDataBuffer;\n}(DataBuffer);\n/** @hidden */\n\n\nvar NativeTexture =\n/** @class */\nfunction (_super) {\n  __extends(NativeTexture, _super);\n\n  function NativeTexture() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  NativeTexture.prototype.getInternalTexture = function () {\n    return this;\n  };\n\n  NativeTexture.prototype.getViewCount = function () {\n    return 1;\n  };\n\n  return NativeTexture;\n}(InternalTexture);\n/** @hidden */\n\n\nvar NativeEngine =\n/** @class */\nfunction (_super) {\n  __extends(NativeEngine, _super);\n\n  function NativeEngine() {\n    var _this = _super.call(this, null) || this;\n\n    _this._native = new _native.Engine();\n    /** Defines the invalid handle returned by bgfx when resource creation goes wrong */\n\n    _this.INVALID_HANDLE = 65535;\n    _this._boundBuffersVertexArray = null;\n    _this._currentDepthTest = _this._native.DEPTH_TEST_LEQUAL;\n    _this._webGLVersion = 2;\n    _this.disableUniformBuffers = true; // TODO: Initialize this more correctly based on the hardware capabilities.\n    // Init caps\n\n    _this._caps = {\n      maxTexturesImageUnits: 16,\n      maxVertexTextureImageUnits: 16,\n      maxCombinedTexturesImageUnits: 32,\n      maxTextureSize: 512,\n      maxCubemapTextureSize: 512,\n      maxRenderTextureSize: 512,\n      maxVertexAttribs: 16,\n      maxVaryingVectors: 16,\n      maxFragmentUniformVectors: 16,\n      maxVertexUniformVectors: 16,\n      standardDerivatives: true,\n      astc: null,\n      pvrtc: null,\n      etc1: null,\n      etc2: null,\n      bptc: null,\n      maxAnisotropy: 16,\n      uintIndices: true,\n      fragmentDepthSupported: false,\n      highPrecisionShaderSupported: true,\n      colorBufferFloat: false,\n      textureFloat: false,\n      textureFloatLinearFiltering: false,\n      textureFloatRender: false,\n      textureHalfFloat: false,\n      textureHalfFloatLinearFiltering: false,\n      textureHalfFloatRender: false,\n      textureLOD: true,\n      drawBuffersExtension: false,\n      depthTextureExtension: false,\n      vertexArrayObject: true,\n      instancedArrays: false,\n      canUseTimestampForTimerQuery: false,\n      blendMinMax: false,\n      maxMSAASamples: 1\n    };\n    Tools.Log(\"Babylon Native (v\" + Engine.Version + \") launched\");\n\n    Tools.LoadScript = function (scriptUrl, onSuccess, onError, scriptId) {\n      Tools.LoadFile(scriptUrl, function (data) {\n        Function(data).apply(null);\n\n        if (onSuccess) {\n          onSuccess();\n        }\n      }, undefined, undefined, false, function (request, exception) {\n        if (onError) {\n          onError(\"LoadScript Error\", exception);\n        }\n      });\n    }; // Wrappers\n\n\n    if (typeof URL === \"undefined\") {\n      window.URL = {\n        createObjectURL: function () {},\n        revokeObjectURL: function () {}\n      };\n    }\n\n    if (typeof Blob === \"undefined\") {\n      window.Blob = function () {};\n    } // Shader processor\n\n\n    _this._shaderProcessor = new WebGL2ShaderProcessor();\n    return _this;\n  }\n\n  NativeEngine.prototype.getHardwareScalingLevel = function () {\n    return 1.0;\n  };\n\n  NativeEngine.prototype.dispose = function () {\n    _super.prototype.dispose.call(this);\n\n    if (this._boundBuffersVertexArray) {\n      this._native.deleteVertexArray(this._boundBuffersVertexArray);\n    }\n\n    this._native.dispose();\n  };\n  /**\r\n   * Can be used to override the current requestAnimationFrame requester.\r\n   * @hidden\r\n   */\n\n\n  NativeEngine.prototype._queueNewFrame = function (bindedRenderFunction, requester) {\n    // Use the provided requestAnimationFrame, unless the requester is the window. In that case, we will default to the Babylon Native version of requestAnimationFrame.\n    if (requester.requestAnimationFrame && requester !== window) {\n      requester.requestAnimationFrame(bindedRenderFunction);\n    } else {\n      this._native.requestAnimationFrame(bindedRenderFunction);\n    }\n\n    return 0;\n  };\n  /**\r\n   * Override default engine behavior.\r\n   * @param color\r\n   * @param backBuffer\r\n   * @param depth\r\n   * @param stencil\r\n   */\n\n\n  NativeEngine.prototype._bindUnboundFramebuffer = function (framebuffer) {\n    if (this._currentFramebuffer !== framebuffer) {\n      if (this._currentFramebuffer) {\n        this._native.unbindFramebuffer(this._currentFramebuffer);\n      }\n\n      if (framebuffer) {\n        this._native.bindFramebuffer(framebuffer);\n      }\n\n      this._currentFramebuffer = framebuffer;\n    }\n  };\n  /**\r\n   * Gets host document\r\n   * @returns the host document object\r\n   */\n\n\n  NativeEngine.prototype.getHostDocument = function () {\n    return null;\n  };\n\n  NativeEngine.prototype.clear = function (color, backBuffer, depth, stencil) {\n    if (stencil === void 0) {\n      stencil = false;\n    }\n\n    var mode = 0;\n\n    if (backBuffer && color) {\n      this._native.clearColor(color.r, color.g, color.b, color.a !== undefined ? color.a : 1.0);\n\n      mode |= this._native.CLEAR_FLAG_COLOR;\n    }\n\n    if (depth) {\n      this._native.clearDepth(1.0);\n\n      mode |= this._native.CLEAR_FLAG_DEPTH;\n    }\n\n    if (stencil) {\n      this._native.clearStencil(0);\n\n      mode |= this._native.CLEAR_FLAG_STENCIL;\n    }\n\n    this._native.clear(mode);\n  };\n\n  NativeEngine.prototype.createIndexBuffer = function (indices, updateable) {\n    var data = this._normalizeIndexData(indices);\n\n    var buffer = new NativeDataBuffer();\n    buffer.references = 1;\n    buffer.is32Bits = data.BYTES_PER_ELEMENT === 4;\n\n    if (data.length) {\n      buffer.nativeIndexBuffer = this._native.createIndexBuffer(data, updateable !== null && updateable !== void 0 ? updateable : false);\n\n      if (buffer.nativeVertexBuffer === this.INVALID_HANDLE) {\n        throw new Error(\"Could not create a native index buffer.\");\n      }\n    } else {\n      buffer.nativeVertexBuffer = this.INVALID_HANDLE;\n    }\n\n    return buffer;\n  };\n\n  NativeEngine.prototype.createVertexBuffer = function (data, updateable) {\n    var buffer = new NativeDataBuffer();\n    buffer.references = 1;\n    buffer.nativeVertexBuffer = this._native.createVertexBuffer(ArrayBuffer.isView(data) ? data : new Float32Array(data), updateable !== null && updateable !== void 0 ? updateable : false);\n\n    if (buffer.nativeVertexBuffer === this.INVALID_HANDLE) {\n      throw new Error(\"Could not create a native vertex buffer.\");\n    }\n\n    return buffer;\n  };\n\n  NativeEngine.prototype._recordVertexArrayObject = function (vertexArray, vertexBuffers, indexBuffer, effect) {\n    if (indexBuffer) {\n      this._native.recordIndexBuffer(vertexArray, indexBuffer.nativeIndexBuffer);\n    }\n\n    var attributes = effect.getAttributesNames();\n\n    for (var index = 0; index < attributes.length; index++) {\n      var location_1 = effect.getAttributeLocation(index);\n\n      if (location_1 >= 0) {\n        var kind = attributes[index];\n        var vertexBuffer = vertexBuffers[kind];\n\n        if (vertexBuffer) {\n          var buffer = vertexBuffer.getBuffer();\n\n          if (buffer) {\n            this._native.recordVertexBuffer(vertexArray, buffer.nativeVertexBuffer, location_1, vertexBuffer.byteOffset, vertexBuffer.byteStride, vertexBuffer.getSize(), this._getNativeAttribType(vertexBuffer.type), vertexBuffer.normalized);\n          }\n        }\n      }\n    }\n  };\n\n  NativeEngine.prototype.bindBuffers = function (vertexBuffers, indexBuffer, effect) {\n    if (this._boundBuffersVertexArray) {\n      this._native.deleteVertexArray(this._boundBuffersVertexArray);\n    }\n\n    this._boundBuffersVertexArray = this._native.createVertexArray();\n\n    this._recordVertexArrayObject(this._boundBuffersVertexArray, vertexBuffers, indexBuffer, effect);\n\n    this._native.bindVertexArray(this._boundBuffersVertexArray);\n  };\n\n  NativeEngine.prototype.recordVertexArrayObject = function (vertexBuffers, indexBuffer, effect) {\n    var vertexArray = this._native.createVertexArray();\n\n    this._recordVertexArrayObject(vertexArray, vertexBuffers, indexBuffer, effect);\n\n    return vertexArray;\n  };\n\n  NativeEngine.prototype.bindVertexArrayObject = function (vertexArray) {\n    this._native.bindVertexArray(vertexArray);\n  };\n\n  NativeEngine.prototype.releaseVertexArrayObject = function (vertexArray) {\n    this._native.deleteVertexArray(vertexArray);\n  };\n\n  NativeEngine.prototype.getAttributes = function (pipelineContext, attributesNames) {\n    var nativePipelineContext = pipelineContext;\n    return this._native.getAttributes(nativePipelineContext.nativeProgram, attributesNames);\n  };\n  /**\r\n   * Draw a list of indexed primitives\r\n   * @param fillMode defines the primitive to use\r\n   * @param indexStart defines the starting index\r\n   * @param indexCount defines the number of index to draw\r\n   * @param instancesCount defines the number of instances to draw (if instanciation is enabled)\r\n   */\n\n\n  NativeEngine.prototype.drawElementsType = function (fillMode, indexStart, indexCount, instancesCount) {\n    // Apply states\n    this._drawCalls.addCount(1, false); // TODO: Make this implementation more robust like core Engine version.\n    // Render\n    //var indexFormat = this._uintIndicesCurrentlySet ? this._gl.UNSIGNED_INT : this._gl.UNSIGNED_SHORT;\n    //var mult = this._uintIndicesCurrentlySet ? 4 : 2;\n    // if (instancesCount) {\n    //     this._gl.drawElementsInstanced(drawMode, indexCount, indexFormat, indexStart * mult, instancesCount);\n    // } else {\n\n\n    this._native.drawIndexed(fillMode, indexStart, indexCount); // }\n\n  };\n  /**\r\n   * Draw a list of unindexed primitives\r\n   * @param fillMode defines the primitive to use\r\n   * @param verticesStart defines the index of first vertex to draw\r\n   * @param verticesCount defines the count of vertices to draw\r\n   * @param instancesCount defines the number of instances to draw (if instanciation is enabled)\r\n   */\n\n\n  NativeEngine.prototype.drawArraysType = function (fillMode, verticesStart, verticesCount, instancesCount) {\n    // Apply states\n    this._drawCalls.addCount(1, false); // TODO: Make this implementation more robust like core Engine version.\n    // if (instancesCount) {\n    //     this._gl.drawArraysInstanced(drawMode, verticesStart, verticesCount, instancesCount);\n    // } else {\n\n\n    this._native.draw(fillMode, verticesStart, verticesCount); // }\n\n  };\n\n  NativeEngine.prototype.createPipelineContext = function () {\n    return new NativePipelineContext();\n  };\n\n  NativeEngine.prototype._preparePipelineContext = function (pipelineContext, vertexSourceCode, fragmentSourceCode, createAsRaw, rebuildRebind, defines, transformFeedbackVaryings) {\n    var nativePipelineContext = pipelineContext;\n\n    if (createAsRaw) {\n      nativePipelineContext.nativeProgram = this.createRawShaderProgram(pipelineContext, vertexSourceCode, fragmentSourceCode, undefined, transformFeedbackVaryings);\n    } else {\n      nativePipelineContext.nativeProgram = this.createShaderProgram(pipelineContext, vertexSourceCode, fragmentSourceCode, defines, undefined, transformFeedbackVaryings);\n    }\n  };\n  /** @hidden */\n\n\n  NativeEngine.prototype._isRenderingStateCompiled = function (pipelineContext) {\n    // TODO: support async shader compilcation\n    return true;\n  };\n  /** @hidden */\n\n\n  NativeEngine.prototype._executeWhenRenderingStateIsCompiled = function (pipelineContext, action) {\n    // TODO: support async shader compilcation\n    action();\n  };\n\n  NativeEngine.prototype.createRawShaderProgram = function (pipelineContext, vertexCode, fragmentCode, context, transformFeedbackVaryings) {\n    if (transformFeedbackVaryings === void 0) {\n      transformFeedbackVaryings = null;\n    }\n\n    throw new Error(\"Not Supported\");\n  };\n\n  NativeEngine.prototype.createShaderProgram = function (pipelineContext, vertexCode, fragmentCode, defines, context, transformFeedbackVaryings) {\n    if (transformFeedbackVaryings === void 0) {\n      transformFeedbackVaryings = null;\n    }\n\n    this.onBeforeShaderCompilationObservable.notifyObservers(this);\n    var vertexInliner = new ShaderCodeInliner(vertexCode);\n    vertexInliner.processCode();\n    vertexCode = vertexInliner.code;\n    var fragmentInliner = new ShaderCodeInliner(fragmentCode);\n    fragmentInliner.processCode();\n    fragmentCode = fragmentInliner.code;\n    vertexCode = ThinEngine._ConcatenateShader(vertexCode, defines);\n    fragmentCode = ThinEngine._ConcatenateShader(fragmentCode, defines);\n\n    var program = this._native.createProgram(vertexCode, fragmentCode);\n\n    this.onAfterShaderCompilationObservable.notifyObservers(this);\n    return program;\n  };\n\n  NativeEngine.prototype._setProgram = function (program) {\n    if (this._currentProgram !== program) {\n      this._native.setProgram(program);\n\n      this._currentProgram = program;\n    }\n  };\n\n  NativeEngine.prototype._releaseEffect = function (effect) {// TODO\n  };\n\n  NativeEngine.prototype._deletePipelineContext = function (pipelineContext) {// TODO\n  };\n\n  NativeEngine.prototype.getUniforms = function (pipelineContext, uniformsNames) {\n    var nativePipelineContext = pipelineContext;\n    return this._native.getUniforms(nativePipelineContext.nativeProgram, uniformsNames);\n  };\n\n  NativeEngine.prototype.bindUniformBlock = function (pipelineContext, blockName, index) {\n    // TODO\n    throw new Error(\"Not Implemented\");\n  };\n\n  NativeEngine.prototype.bindSamplers = function (effect) {\n    var nativePipelineContext = effect.getPipelineContext();\n\n    this._setProgram(nativePipelineContext.nativeProgram); // TODO: share this with engine?\n\n\n    var samplers = effect.getSamplers();\n\n    for (var index = 0; index < samplers.length; index++) {\n      var uniform = effect.getUniform(samplers[index]);\n\n      if (uniform) {\n        this._boundUniforms[index] = uniform;\n      }\n    }\n\n    this._currentEffect = null;\n  };\n\n  NativeEngine.prototype.setMatrix = function (uniform, matrix) {\n    if (!uniform) {\n      return;\n    }\n\n    this._native.setMatrix(uniform, matrix.toArray());\n  };\n\n  NativeEngine.prototype.getRenderWidth = function (useScreen) {\n    if (useScreen === void 0) {\n      useScreen = false;\n    }\n\n    if (!useScreen && this._currentRenderTarget) {\n      return this._currentRenderTarget.width;\n    }\n\n    return this._native.getRenderWidth();\n  };\n\n  NativeEngine.prototype.getRenderHeight = function (useScreen) {\n    if (useScreen === void 0) {\n      useScreen = false;\n    }\n\n    if (!useScreen && this._currentRenderTarget) {\n      return this._currentRenderTarget.height;\n    }\n\n    return this._native.getRenderHeight();\n  };\n\n  NativeEngine.prototype.setViewport = function (viewport, requiredWidth, requiredHeight) {\n    this._cachedViewport = viewport;\n\n    this._native.setViewPort(viewport.x, viewport.y, viewport.width, viewport.height);\n  };\n\n  NativeEngine.prototype.setState = function (culling, zOffset, force, reverseSide) {\n    if (zOffset === void 0) {\n      zOffset = 0;\n    }\n\n    if (reverseSide === void 0) {\n      reverseSide = false;\n    }\n\n    this._native.setState(culling, zOffset, reverseSide);\n  };\n  /**\r\n   * Set the z offset to apply to current rendering\r\n   * @param value defines the offset to apply\r\n   */\n\n\n  NativeEngine.prototype.setZOffset = function (value) {\n    this._native.setZOffset(value);\n  };\n  /**\r\n   * Gets the current value of the zOffset\r\n   * @returns the current zOffset state\r\n   */\n\n\n  NativeEngine.prototype.getZOffset = function () {\n    return this._native.getZOffset();\n  };\n  /**\r\n   * Enable or disable depth buffering\r\n   * @param enable defines the state to set\r\n   */\n\n\n  NativeEngine.prototype.setDepthBuffer = function (enable) {\n    this._native.setDepthTest(enable ? this._currentDepthTest : this._native.DEPTH_TEST_ALWAYS);\n  };\n  /**\r\n   * Gets a boolean indicating if depth writing is enabled\r\n   * @returns the current depth writing state\r\n   */\n\n\n  NativeEngine.prototype.getDepthWrite = function () {\n    return this._native.getDepthWrite();\n  };\n\n  NativeEngine.prototype.setDepthFunctionToGreater = function () {\n    this._currentDepthTest = this._native.DEPTH_TEST_GREATER;\n\n    this._native.setDepthTest(this._currentDepthTest);\n  };\n\n  NativeEngine.prototype.setDepthFunctionToGreaterOrEqual = function () {\n    this._currentDepthTest = this._native.DEPTH_TEST_GEQUAL;\n\n    this._native.setDepthTest(this._currentDepthTest);\n  };\n\n  NativeEngine.prototype.setDepthFunctionToLess = function () {\n    this._currentDepthTest = this._native.DEPTH_TEST_LESS;\n\n    this._native.setDepthTest(this._currentDepthTest);\n  };\n\n  NativeEngine.prototype.setDepthFunctionToLessOrEqual = function () {\n    this._currentDepthTest = this._native.DEPTH_TEST_LEQUAL;\n\n    this._native.setDepthTest(this._currentDepthTest);\n  };\n  /**\r\n   * Enable or disable depth writing\r\n   * @param enable defines the state to set\r\n   */\n\n\n  NativeEngine.prototype.setDepthWrite = function (enable) {\n    this._native.setDepthWrite(enable);\n  };\n  /**\r\n   * Enable or disable color writing\r\n   * @param enable defines the state to set\r\n   */\n\n\n  NativeEngine.prototype.setColorWrite = function (enable) {\n    this._native.setColorWrite(enable);\n\n    this._colorWrite = enable;\n  };\n  /**\r\n   * Gets a boolean indicating if color writing is enabled\r\n   * @returns the current color writing state\r\n   */\n\n\n  NativeEngine.prototype.getColorWrite = function () {\n    return this._colorWrite;\n  };\n  /**\r\n   * Sets alpha constants used by some alpha blending modes\r\n   * @param r defines the red component\r\n   * @param g defines the green component\r\n   * @param b defines the blue component\r\n   * @param a defines the alpha component\r\n   */\n\n\n  NativeEngine.prototype.setAlphaConstants = function (r, g, b, a) {\n    throw new Error(\"Setting alpha blend constant color not yet implemented.\");\n  };\n  /**\r\n   * Sets the current alpha mode\r\n   * @param mode defines the mode to use (one of the BABYLON.undefined)\r\n   * @param noDepthWriteChange defines if depth writing state should remains unchanged (false by default)\r\n   * @see https://doc.babylonjs.com/resources/transparency_and_how_meshes_are_rendered\r\n   */\n\n\n  NativeEngine.prototype.setAlphaMode = function (mode, noDepthWriteChange) {\n    if (noDepthWriteChange === void 0) {\n      noDepthWriteChange = false;\n    }\n\n    if (this._alphaMode === mode) {\n      return;\n    }\n\n    mode = this._getNativeAlphaMode(mode);\n\n    this._native.setBlendMode(mode);\n\n    if (!noDepthWriteChange) {\n      this.setDepthWrite(mode === 0);\n    }\n\n    this._alphaMode = mode;\n  };\n  /**\r\n   * Gets the current alpha mode\r\n   * @see https://doc.babylonjs.com/resources/transparency_and_how_meshes_are_rendered\r\n   * @returns the current alpha mode\r\n   */\n\n\n  NativeEngine.prototype.getAlphaMode = function () {\n    return this._alphaMode;\n  };\n\n  NativeEngine.prototype.setInt = function (uniform, int) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setInt(uniform, int);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setIntArray = function (uniform, array) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setIntArray(uniform, array);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setIntArray2 = function (uniform, array) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setIntArray2(uniform, array);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setIntArray3 = function (uniform, array) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setIntArray3(uniform, array);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setIntArray4 = function (uniform, array) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setIntArray4(uniform, array);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setFloatArray = function (uniform, array) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setFloatArray(uniform, array);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setFloatArray2 = function (uniform, array) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setFloatArray2(uniform, array);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setFloatArray3 = function (uniform, array) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setFloatArray3(uniform, array);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setFloatArray4 = function (uniform, array) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setFloatArray4(uniform, array);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setArray = function (uniform, array) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setFloatArray(uniform, array);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setArray2 = function (uniform, array) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setFloatArray2(uniform, array);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setArray3 = function (uniform, array) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setFloatArray3(uniform, array);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setArray4 = function (uniform, array) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setFloatArray4(uniform, array);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setMatrices = function (uniform, matrices) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setMatrices(uniform, matrices);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setMatrix3x3 = function (uniform, matrix) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setMatrix3x3(uniform, matrix);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setMatrix2x2 = function (uniform, matrix) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setMatrix2x2(uniform, matrix);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setFloat = function (uniform, value) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setFloat(uniform, value);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setFloat2 = function (uniform, x, y) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setFloat2(uniform, x, y);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setFloat3 = function (uniform, x, y, z) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setFloat3(uniform, x, y, z);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setFloat4 = function (uniform, x, y, z, w) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setFloat4(uniform, x, y, z, w);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setColor3 = function (uniform, color3) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setFloat3(uniform, color3.r, color3.g, color3.b);\n\n    return true;\n  };\n\n  NativeEngine.prototype.setColor4 = function (uniform, color3, alpha) {\n    if (!uniform) {\n      return false;\n    }\n\n    this._native.setFloat4(uniform, color3.r, color3.g, color3.b, alpha);\n\n    return true;\n  };\n\n  NativeEngine.prototype.wipeCaches = function (bruteForce) {\n    if (this.preventCacheWipeBetweenFrames) {\n      return;\n    }\n\n    this.resetTextureCache();\n    this._currentEffect = null;\n\n    if (bruteForce) {\n      this._currentProgram = null;\n\n      this._stencilState.reset();\n\n      this._depthCullingState.reset();\n\n      this._alphaState.reset();\n    }\n\n    this._cachedVertexBuffers = null;\n    this._cachedIndexBuffer = null;\n    this._cachedEffectForVertexBuffers = null;\n  };\n\n  NativeEngine.prototype._createTexture = function () {\n    return this._native.createTexture();\n  };\n\n  NativeEngine.prototype._deleteTexture = function (texture) {\n    this._native.deleteTexture(texture);\n  };\n  /**\r\n   * Update the content of a dynamic texture\r\n   * @param texture defines the texture to update\r\n   * @param canvas defines the canvas containing the source\r\n   * @param invertY defines if data must be stored with Y axis inverted\r\n   * @param premulAlpha defines if alpha is stored as premultiplied\r\n   * @param format defines the format of the data\r\n   * @param forceBindTexture if the texture should be forced to be bound eg. after a graphics context loss (Default: false)\r\n   */\n\n\n  NativeEngine.prototype.updateDynamicTexture = function (texture, canvas, invertY, premulAlpha, format) {\n    if (premulAlpha === void 0) {\n      premulAlpha = false;\n    } // TODO: Stub! This function is needed for some GLTF validation tests.\n    // Loads a dummy 8x8 transparent png\n\n\n    var imageData = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYSURBVChTY/z//z8DPsAEpXGC4aCAgQEAGGMDDWwwgqsAAAAASUVORK5CYII=';\n    this.createTexture('data:my_image_name', true, invertY, null, Texture.BILINEAR_SAMPLINGMODE, undefined, undefined, imageData, texture, NativeEngine.TEXTUREFORMAT_RGBA, null, undefined);\n  }; // TODO: Refactor to share more logic with babylon.engine.ts version.\n\n  /**\r\n   * Usually called from Texture.ts.\r\n   * Passed information to create a WebGLTexture\r\n   * @param url defines a value which contains one of the following:\r\n   * * A conventional http URL, e.g. 'http://...' or 'file://...'\r\n   * * A base64 string of in-line texture data, e.g. 'data:image/jpg;base64,/...'\r\n   * * An indicator that data being passed using the buffer parameter, e.g. 'data:mytexture.jpg'\r\n   * @param noMipmap defines a boolean indicating that no mipmaps shall be generated.  Ignored for compressed textures.  They must be in the file\r\n   * @param invertY when true, image is flipped when loaded.  You probably want true. Certain compressed textures may invert this if their default is inverted (eg. ktx)\r\n   * @param scene needed for loading to the correct scene\r\n   * @param samplingMode mode with should be used sample / access the texture (Default: Texture.TRILINEAR_SAMPLINGMODE)\r\n   * @param onLoad optional callback to be called upon successful completion\r\n   * @param onError optional callback to be called upon failure\r\n   * @param buffer a source of a file previously fetched as either a base64 string, an ArrayBuffer (compressed or image format), HTMLImageElement (image format), or a Blob\r\n   * @param fallback an internal argument in case the function must be called again, due to etc1 not having alpha capabilities\r\n   * @param format internal format.  Default: RGB when extension is '.jpg' else RGBA.  Ignored for compressed textures\r\n   * @param forcedExtension defines the extension to use to pick the right loader\r\n   * @param mimeType defines an optional mime type\r\n   * @param loaderOptions options to be passed to the loader\r\n   * @returns a InternalTexture for assignment back into BABYLON.Texture\r\n   */\n\n\n  NativeEngine.prototype.createTexture = function (url, noMipmap, invertY, scene, samplingMode, onLoad, onError, buffer, fallback, format, forcedExtension, mimeType, loaderOptions) {\n    var _this = this;\n\n    if (samplingMode === void 0) {\n      samplingMode = 3;\n    }\n\n    if (onLoad === void 0) {\n      onLoad = null;\n    }\n\n    if (onError === void 0) {\n      onError = null;\n    }\n\n    if (buffer === void 0) {\n      buffer = null;\n    }\n\n    if (fallback === void 0) {\n      fallback = null;\n    }\n\n    if (format === void 0) {\n      format = null;\n    }\n\n    if (forcedExtension === void 0) {\n      forcedExtension = null;\n    }\n\n    url = url || \"\";\n    var fromData = url.substr(0, 5) === \"data:\"; //const fromBlob = url.substr(0, 5) === \"blob:\";\n\n    var isBase64 = fromData && url.indexOf(\";base64,\") !== -1;\n    var texture = fallback ? fallback : new InternalTexture(this, InternalTextureSource.Url);\n    var originalUrl = url;\n\n    if (this._transformTextureUrl && !isBase64 && !fallback && !buffer) {\n      url = this._transformTextureUrl(url);\n    } // establish the file extension, if possible\n\n\n    var lastDot = url.lastIndexOf('.');\n    var extension = forcedExtension ? forcedExtension : lastDot > -1 ? url.substring(lastDot).toLowerCase() : \"\";\n    var loader = null;\n\n    for (var _i = 0, _a = Engine._TextureLoaders; _i < _a.length; _i++) {\n      var availableLoader = _a[_i];\n\n      if (availableLoader.canLoad(extension)) {\n        loader = availableLoader;\n        break;\n      }\n    }\n\n    if (scene) {\n      scene._addPendingData(texture);\n    }\n\n    texture.url = url;\n    texture.generateMipMaps = !noMipmap;\n    texture.samplingMode = samplingMode;\n    texture.invertY = invertY;\n\n    if (!this.doNotHandleContextLost) {\n      // Keep a link to the buffer only if we plan to handle context lost\n      texture._buffer = buffer;\n    }\n\n    var onLoadObserver = null;\n\n    if (onLoad && !fallback) {\n      onLoadObserver = texture.onLoadedObservable.add(onLoad);\n    }\n\n    if (!fallback) {\n      this._internalTexturesCache.push(texture);\n    }\n\n    var onInternalError = function (message, exception) {\n      if (scene) {\n        scene._removePendingData(texture);\n      }\n\n      if (url === originalUrl) {\n        if (onLoadObserver) {\n          texture.onLoadedObservable.remove(onLoadObserver);\n        }\n\n        if (EngineStore.UseFallbackTexture) {\n          _this.createTexture(EngineStore.FallbackTexture, noMipmap, texture.invertY, scene, samplingMode, null, onError, buffer, texture);\n        }\n\n        if (onError) {\n          onError((message || \"Unknown error\") + (EngineStore.UseFallbackTexture ? \" - Fallback texture was used\" : \"\"), exception);\n        }\n      } else {\n        // fall back to the original url if the transformed url fails to load\n        Logger.Warn(\"Failed to load \" + url + \", falling back to \" + originalUrl);\n\n        _this.createTexture(originalUrl, noMipmap, texture.invertY, scene, samplingMode, onLoad, onError, buffer, texture, format, forcedExtension, mimeType, loaderOptions);\n      }\n    }; // processing for non-image formats\n\n\n    if (loader) {\n      throw new Error(\"Loading textures from IInternalTextureLoader not yet implemented.\");\n    } else {\n      var onload_1 = function (data) {\n        var webGLTexture = texture._webGLTexture;\n\n        if (!webGLTexture) {\n          if (scene) {\n            scene._removePendingData(texture);\n          }\n\n          return;\n        }\n\n        _this._native.loadTexture(webGLTexture, data, !noMipmap, invertY, function () {\n          texture.baseWidth = _this._native.getTextureWidth(webGLTexture);\n          texture.baseHeight = _this._native.getTextureHeight(webGLTexture);\n          texture.width = texture.baseWidth;\n          texture.height = texture.baseHeight;\n          texture.isReady = true;\n\n          var filter = _this._getNativeSamplingMode(samplingMode);\n\n          _this._native.setTextureSampling(webGLTexture, filter);\n\n          if (scene) {\n            scene._removePendingData(texture);\n          }\n\n          texture.onLoadedObservable.notifyObservers(texture);\n          texture.onLoadedObservable.clear();\n        }, function () {\n          throw new Error(\"Could not load a native texture.\");\n        });\n      };\n\n      if (fromData) {\n        if (buffer instanceof ArrayBuffer) {\n          onload_1(new Uint8Array(buffer));\n        } else if (ArrayBuffer.isView(buffer)) {\n          onload_1(buffer);\n        } else if (typeof buffer === \"string\") {\n          onload_1(new Uint8Array(Tools.DecodeBase64(buffer)));\n        } else {\n          throw new Error(\"Unsupported buffer type\");\n        }\n      } else {\n        if (isBase64) {\n          onload_1(new Uint8Array(Tools.DecodeBase64(url)));\n        } else {\n          this._loadFile(url, function (data) {\n            return onload_1(new Uint8Array(data));\n          }, undefined, undefined, true, function (request, exception) {\n            onInternalError(\"Unable to load \" + (request ? request.responseURL : url, exception));\n          });\n        }\n      }\n    }\n\n    return texture;\n  };\n\n  NativeEngine.prototype._createDepthStencilTexture = function (size, options) {\n    var texture = new NativeTexture(this, InternalTextureSource.Depth);\n    var width = size.width || size;\n    var height = size.height || size;\n\n    var framebuffer = this._native.createDepthTexture(texture._webGLTexture, width, height);\n\n    texture._framebuffer = framebuffer;\n    return texture;\n  };\n\n  NativeEngine.prototype._releaseFramebufferObjects = function (texture) {// TODO\n  };\n  /**\r\n   * Creates a cube texture\r\n   * @param rootUrl defines the url where the files to load is located\r\n   * @param scene defines the current scene\r\n   * @param files defines the list of files to load (1 per face)\r\n   * @param noMipmap defines a boolean indicating that no mipmaps shall be generated (false by default)\r\n   * @param onLoad defines an optional callback raised when the texture is loaded\r\n   * @param onError defines an optional callback raised if there is an issue to load the texture\r\n   * @param format defines the format of the data\r\n   * @param forcedExtension defines the extension to use to pick the right loader\r\n   * @param createPolynomials if a polynomial sphere should be created for the cube texture\r\n   * @param lodScale defines the scale applied to environment texture. This manages the range of LOD level used for IBL according to the roughness\r\n   * @param lodOffset defines the offset applied to environment texture. This manages first LOD level used for IBL according to the roughness\r\n   * @param fallback defines texture to use while falling back when (compressed) texture file not found.\r\n   * @returns the cube texture as an InternalTexture\r\n   */\n\n\n  NativeEngine.prototype.createCubeTexture = function (rootUrl, scene, files, noMipmap, onLoad, onError, format, forcedExtension, createPolynomials, lodScale, lodOffset, fallback) {\n    var _this = this;\n\n    if (onLoad === void 0) {\n      onLoad = null;\n    }\n\n    if (onError === void 0) {\n      onError = null;\n    }\n\n    if (forcedExtension === void 0) {\n      forcedExtension = null;\n    }\n\n    if (createPolynomials === void 0) {\n      createPolynomials = false;\n    }\n\n    if (lodScale === void 0) {\n      lodScale = 0;\n    }\n\n    if (lodOffset === void 0) {\n      lodOffset = 0;\n    }\n\n    if (fallback === void 0) {\n      fallback = null;\n    }\n\n    var texture = fallback ? fallback : new InternalTexture(this, InternalTextureSource.Cube);\n    texture.isCube = true;\n    texture.url = rootUrl;\n    texture.generateMipMaps = !noMipmap;\n    texture._lodGenerationScale = lodScale;\n    texture._lodGenerationOffset = lodOffset;\n\n    if (!this._doNotHandleContextLost) {\n      texture._extension = forcedExtension;\n      texture._files = files;\n    }\n\n    var lastDot = rootUrl.lastIndexOf('.');\n    var extension = forcedExtension ? forcedExtension : lastDot > -1 ? rootUrl.substring(lastDot).toLowerCase() : \"\"; // TODO: use texture loader to load env files?\n\n    if (extension === \".env\") {\n      var onloaddata_1 = function (data) {\n        var info = EnvironmentTextureTools.GetEnvInfo(data);\n        texture.width = info.width;\n        texture.height = info.width;\n        EnvironmentTextureTools.UploadEnvSpherical(texture, info);\n\n        if (info.version !== 1) {\n          throw new Error(\"Unsupported babylon environment map version \\\"\" + info.version + \"\\\"\");\n        }\n\n        var specularInfo = info.specular;\n\n        if (!specularInfo) {\n          throw new Error(\"Nothing else parsed so far\");\n        }\n\n        texture._lodGenerationScale = specularInfo.lodGenerationScale;\n        var imageData = EnvironmentTextureTools.CreateImageDataArrayBufferViews(data, info);\n        texture.format = 5;\n        texture.type = 0;\n        texture.generateMipMaps = true;\n        texture.getEngine().updateTextureSamplingMode(Texture.TRILINEAR_SAMPLINGMODE, texture);\n        texture._isRGBD = true;\n        texture.invertY = true;\n\n        _this._native.loadCubeTextureWithMips(texture._webGLTexture, imageData, function () {\n          texture.isReady = true;\n\n          if (onLoad) {\n            onLoad();\n          }\n        }, function () {\n          throw new Error(\"Could not load a native cube texture.\");\n        });\n      };\n\n      if (files && files.length === 6) {\n        throw new Error(\"Multi-file loading not allowed on env files.\");\n      } else {\n        var onInternalError = function (request, exception) {\n          if (onError && request) {\n            onError(request.status + \" \" + request.statusText, exception);\n          }\n        };\n\n        this._loadFile(rootUrl, function (data) {\n          return onloaddata_1(new Uint8Array(data));\n        }, undefined, undefined, true, onInternalError);\n      }\n    } else {\n      if (!files || files.length !== 6) {\n        throw new Error(\"Cannot load cubemap because 6 files were not defined\");\n      } // Reorder from [+X, +Y, +Z, -X, -Y, -Z] to [+X, -X, +Y, -Y, +Z, -Z].\n\n\n      var reorderedFiles = [files[0], files[3], files[1], files[4], files[2], files[5]];\n      Promise.all(reorderedFiles.map(function (file) {\n        return Tools.LoadFileAsync(file).then(function (data) {\n          return new Uint8Array(data);\n        });\n      })).then(function (data) {\n        return new Promise(function (resolve, reject) {\n          _this._native.loadCubeTexture(texture._webGLTexture, data, !noMipmap, resolve, reject);\n        });\n      }).then(function () {\n        texture.isReady = true;\n\n        if (onLoad) {\n          onLoad();\n        }\n      }, function (error) {\n        if (onError) {\n          onError(\"Failed to load cubemap: \" + error.message, error);\n        }\n      });\n    }\n\n    this._internalTexturesCache.push(texture);\n\n    return texture;\n  };\n\n  NativeEngine.prototype.createRenderTargetTexture = function (size, options) {\n    var fullOptions = new RenderTargetCreationOptions();\n\n    if (options !== undefined && typeof options === \"object\") {\n      fullOptions.generateMipMaps = options.generateMipMaps;\n      fullOptions.generateDepthBuffer = options.generateDepthBuffer === undefined ? true : options.generateDepthBuffer;\n      fullOptions.generateStencilBuffer = fullOptions.generateDepthBuffer && options.generateStencilBuffer;\n      fullOptions.type = options.type === undefined ? 0 : options.type;\n      fullOptions.samplingMode = options.samplingMode === undefined ? 3 : options.samplingMode;\n      fullOptions.format = options.format === undefined ? 5 : options.format;\n    } else {\n      fullOptions.generateMipMaps = options;\n      fullOptions.generateDepthBuffer = true;\n      fullOptions.generateStencilBuffer = false;\n      fullOptions.type = 0;\n      fullOptions.samplingMode = 3;\n      fullOptions.format = 5;\n    }\n\n    if (fullOptions.type === 1 && !this._caps.textureFloatLinearFiltering) {\n      // if floating point linear (gl.FLOAT) then force to NEAREST_SAMPLINGMODE\n      fullOptions.samplingMode = 1;\n    } else if (fullOptions.type === 2 && !this._caps.textureHalfFloatLinearFiltering) {\n      // if floating point linear (HALF_FLOAT) then force to NEAREST_SAMPLINGMODE\n      fullOptions.samplingMode = 1;\n    }\n\n    var texture = new NativeTexture(this, InternalTextureSource.RenderTarget);\n    var width = size.width || size;\n    var height = size.height || size;\n\n    if (fullOptions.type === 1 && !this._caps.textureFloat) {\n      fullOptions.type = 0;\n      Logger.Warn(\"Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type\");\n    }\n\n    var framebuffer = this._native.createFramebuffer(texture._webGLTexture, width, height, this._getNativeTextureFormat(fullOptions.format, fullOptions.type), fullOptions.samplingMode, fullOptions.generateStencilBuffer ? true : false, fullOptions.generateDepthBuffer, fullOptions.generateMipMaps ? true : false);\n\n    texture._framebuffer = framebuffer;\n    texture.baseWidth = width;\n    texture.baseHeight = height;\n    texture.width = width;\n    texture.height = height;\n    texture.isReady = true;\n    texture.samples = 1;\n    texture.generateMipMaps = fullOptions.generateMipMaps ? true : false;\n    texture.samplingMode = fullOptions.samplingMode;\n    texture.type = fullOptions.type;\n    texture.format = fullOptions.format;\n    texture._generateDepthBuffer = fullOptions.generateDepthBuffer;\n    texture._generateStencilBuffer = fullOptions.generateStencilBuffer ? true : false;\n\n    this._internalTexturesCache.push(texture);\n\n    return texture;\n  };\n\n  NativeEngine.prototype.updateTextureSamplingMode = function (samplingMode, texture) {\n    if (texture._webGLTexture) {\n      var filter = this._getNativeSamplingMode(samplingMode);\n\n      this._native.setTextureSampling(texture._webGLTexture, filter);\n    }\n\n    texture.samplingMode = samplingMode;\n  };\n\n  NativeEngine.prototype.bindFramebuffer = function (texture, faceIndex, requiredWidth, requiredHeight, forceFullscreenViewport) {\n    if (faceIndex) {\n      throw new Error(\"Cuboid frame buffers are not yet supported in NativeEngine.\");\n    }\n\n    if (requiredWidth || requiredHeight) {\n      throw new Error(\"Required width/height for frame buffers not yet supported in NativeEngine.\");\n    }\n\n    if (forceFullscreenViewport) {//Not supported yet but don't stop rendering\n    }\n\n    if (texture._depthStencilTexture) {\n      this._bindUnboundFramebuffer(texture._depthStencilTexture._framebuffer);\n    } else {\n      this._bindUnboundFramebuffer(texture._framebuffer);\n    }\n  };\n\n  NativeEngine.prototype.unBindFramebuffer = function (texture, disableGenerateMipMaps, onBeforeUnbind) {\n    if (disableGenerateMipMaps === void 0) {\n      disableGenerateMipMaps = false;\n    }\n\n    if (disableGenerateMipMaps) {\n      Logger.Warn(\"Disabling mipmap generation not yet supported in NativeEngine. Ignoring.\");\n    }\n\n    if (onBeforeUnbind) {\n      onBeforeUnbind();\n    }\n\n    this._bindUnboundFramebuffer(null);\n  };\n\n  NativeEngine.prototype.createDynamicVertexBuffer = function (data) {\n    return this.createVertexBuffer(data, true);\n  };\n\n  NativeEngine.prototype.updateDynamicIndexBuffer = function (indexBuffer, indices, offset) {\n    if (offset === void 0) {\n      offset = 0;\n    }\n\n    var buffer = indexBuffer;\n\n    var data = this._normalizeIndexData(indices);\n\n    buffer.is32Bits = data.BYTES_PER_ELEMENT === 4;\n\n    this._native.updateDynamicIndexBuffer(buffer.nativeIndexBuffer, data, offset);\n  };\n  /**\r\n   * Updates a dynamic vertex buffer.\r\n   * @param vertexBuffer the vertex buffer to update\r\n   * @param data the data used to update the vertex buffer\r\n   * @param byteOffset the byte offset of the data (optional)\r\n   * @param byteLength the byte length of the data (optional)\r\n   */\n\n\n  NativeEngine.prototype.updateDynamicVertexBuffer = function (vertexBuffer, data, byteOffset, byteLength) {\n    var buffer = vertexBuffer;\n    var dataView = ArrayBuffer.isView(data) ? data : new Float32Array(data);\n\n    this._native.updateDynamicVertexBuffer(buffer.nativeVertexBuffer, dataView, byteOffset !== null && byteOffset !== void 0 ? byteOffset : 0, byteLength !== null && byteLength !== void 0 ? byteLength : dataView.byteLength);\n  }; // TODO: Refactor to share more logic with base Engine implementation.\n\n\n  NativeEngine.prototype._setTexture = function (channel, texture, isPartOfTextureArray, depthStencilTexture) {\n    if (isPartOfTextureArray === void 0) {\n      isPartOfTextureArray = false;\n    }\n\n    if (depthStencilTexture === void 0) {\n      depthStencilTexture = false;\n    }\n\n    var uniform = this._boundUniforms[channel];\n\n    if (!uniform) {\n      return false;\n    } // Not ready?\n\n\n    if (!texture) {\n      if (this._boundTexturesCache[channel] != null) {\n        this._activeChannel = channel;\n\n        this._native.setTexture(uniform, null);\n      }\n\n      return false;\n    } // Video\n\n\n    if (texture.video) {\n      this._activeChannel = channel;\n      texture.update();\n    } else if (texture.delayLoadState === 4) {\n      // Delay loading\n      texture.delayLoad();\n      return false;\n    }\n\n    var internalTexture;\n\n    if (depthStencilTexture) {\n      internalTexture = texture.depthStencilTexture;\n    } else if (texture.isReady()) {\n      internalTexture = texture.getInternalTexture();\n    } else if (texture.isCube) {\n      internalTexture = this.emptyCubeTexture;\n    } else if (texture.is3D) {\n      internalTexture = this.emptyTexture3D;\n    } else if (texture.is2DArray) {\n      internalTexture = this.emptyTexture2DArray;\n    } else {\n      internalTexture = this.emptyTexture;\n    }\n\n    this._activeChannel = channel;\n\n    if (!internalTexture || !internalTexture._webGLTexture) {\n      return false;\n    }\n\n    this._native.setTextureWrapMode(internalTexture._webGLTexture, this._getAddressMode(texture.wrapU), this._getAddressMode(texture.wrapV), this._getAddressMode(texture.wrapR));\n\n    this._updateAnisotropicLevel(texture);\n\n    this._native.setTexture(uniform, internalTexture._webGLTexture);\n\n    return true;\n  }; // TODO: Share more of this logic with the base implementation.\n  // TODO: Rename to match naming in base implementation once refactoring allows different parameters.\n\n\n  NativeEngine.prototype._updateAnisotropicLevel = function (texture) {\n    var internalTexture = texture.getInternalTexture();\n    var value = texture.anisotropicFilteringLevel;\n\n    if (!internalTexture || !internalTexture._webGLTexture) {\n      return;\n    }\n\n    if (internalTexture._cachedAnisotropicFilteringLevel !== value) {\n      this._native.setTextureAnisotropicLevel(internalTexture._webGLTexture, value);\n\n      internalTexture._cachedAnisotropicFilteringLevel = value;\n    }\n  }; // Returns a NativeAddressMode.XXX value.\n\n\n  NativeEngine.prototype._getAddressMode = function (wrapMode) {\n    switch (wrapMode) {\n      case 1:\n        return this._native.ADDRESS_MODE_WRAP;\n\n      case 0:\n        return this._native.ADDRESS_MODE_CLAMP;\n\n      case 2:\n        return this._native.ADDRESS_MODE_MIRROR;\n\n      default:\n        throw new Error(\"Unexpected wrap mode: \" + wrapMode + \".\");\n    }\n  };\n  /** @hidden */\n\n\n  NativeEngine.prototype._bindTexture = function (channel, texture) {\n    var uniform = this._boundUniforms[channel];\n\n    if (!uniform) {\n      return;\n    }\n\n    this._native.setTexture(uniform, texture._webGLTexture);\n  };\n\n  NativeEngine.prototype._deleteBuffer = function (buffer) {\n    if (buffer.nativeIndexBuffer) {\n      this._native.deleteIndexBuffer(buffer.nativeIndexBuffer);\n\n      delete buffer.nativeIndexBuffer;\n    }\n\n    if (buffer.nativeVertexBuffer) {\n      this._native.deleteVertexBuffer(buffer.nativeVertexBuffer);\n\n      delete buffer.nativeVertexBuffer;\n    }\n  };\n\n  NativeEngine.prototype.releaseEffects = function () {// TODO\n  };\n  /** @hidden */\n\n\n  NativeEngine.prototype._uploadCompressedDataToTextureDirectly = function (texture, internalFormat, width, height, data, faceIndex, lod) {\n    if (faceIndex === void 0) {\n      faceIndex = 0;\n    }\n\n    if (lod === void 0) {\n      lod = 0;\n    }\n\n    throw new Error(\"_uploadCompressedDataToTextureDirectly not implemented.\");\n  };\n  /** @hidden */\n\n\n  NativeEngine.prototype._uploadDataToTextureDirectly = function (texture, imageData, faceIndex, lod) {\n    if (faceIndex === void 0) {\n      faceIndex = 0;\n    }\n\n    if (lod === void 0) {\n      lod = 0;\n    }\n\n    throw new Error(\"_uploadDataToTextureDirectly not implemented.\");\n  };\n  /** @hidden */\n\n\n  NativeEngine.prototype._uploadArrayBufferViewToTexture = function (texture, imageData, faceIndex, lod) {\n    if (faceIndex === void 0) {\n      faceIndex = 0;\n    }\n\n    if (lod === void 0) {\n      lod = 0;\n    }\n\n    throw new Error(\"_uploadArrayBufferViewToTexture not implemented.\");\n  };\n  /** @hidden */\n\n\n  NativeEngine.prototype._uploadImageToTexture = function (texture, image, faceIndex, lod) {\n    if (faceIndex === void 0) {\n      faceIndex = 0;\n    }\n\n    if (lod === void 0) {\n      lod = 0;\n    }\n\n    throw new Error(\"_uploadArrayBufferViewToTexture not implemented.\");\n  }; // JavaScript-to-Native conversion helper functions.\n\n\n  NativeEngine.prototype._getNativeSamplingMode = function (samplingMode) {\n    switch (samplingMode) {\n      case 1:\n        return this._native.TEXTURE_NEAREST_NEAREST;\n\n      case 2:\n        return this._native.TEXTURE_LINEAR_LINEAR;\n\n      case 3:\n        return this._native.TEXTURE_LINEAR_LINEAR_MIPLINEAR;\n\n      case 4:\n        return this._native.TEXTURE_NEAREST_NEAREST_MIPNEAREST;\n\n      case 5:\n        return this._native.TEXTURE_NEAREST_LINEAR_MIPNEAREST;\n\n      case 6:\n        return this._native.TEXTURE_NEAREST_LINEAR_MIPLINEAR;\n\n      case 7:\n        return this._native.TEXTURE_NEAREST_LINEAR;\n\n      case 8:\n        return this._native.TEXTURE_NEAREST_NEAREST_MIPLINEAR;\n\n      case 9:\n        return this._native.TEXTURE_LINEAR_NEAREST_MIPNEAREST;\n\n      case 10:\n        return this._native.TEXTURE_LINEAR_NEAREST_MIPLINEAR;\n\n      case 11:\n        return this._native.TEXTURE_LINEAR_LINEAR_MIPNEAREST;\n\n      case 12:\n        return this._native.TEXTURE_LINEAR_NEAREST;\n\n      default:\n        throw new Error(\"Unsupported sampling mode: \" + samplingMode + \".\");\n    }\n  };\n\n  NativeEngine.prototype._getNativeTextureFormat = function (format, type) {\n    if (format == 5 && type == 0) {\n      return this._native.TEXTURE_FORMAT_RGBA8;\n    } else if (format == 5 && type == 1) {\n      return this._native.TEXTURE_FORMAT_RGBA32F;\n    } else {\n      throw new Error(\"Unsupported texture format or type: format \" + format + \", type \" + type + \".\");\n    }\n  };\n\n  NativeEngine.prototype._getNativeAlphaMode = function (mode) {\n    switch (mode) {\n      case 0:\n        return this._native.ALPHA_DISABLE;\n\n      case 1:\n        return this._native.ALPHA_ADD;\n\n      case 2:\n        return this._native.ALPHA_COMBINE;\n\n      case 3:\n        return this._native.ALPHA_SUBTRACT;\n\n      case 4:\n        return this._native.ALPHA_MULTIPLY;\n\n      case 5:\n        return this._native.ALPHA_MAXIMIZED;\n\n      case 6:\n        return this._native.ALPHA_ONEONE;\n\n      case 7:\n        return this._native.ALPHA_PREMULTIPLIED;\n\n      case 8:\n        return this._native.ALPHA_PREMULTIPLIED_PORTERDUFF;\n\n      case 9:\n        return this._native.ALPHA_INTERPOLATE;\n\n      case 10:\n        return this._native.ALPHA_SCREENMODE;\n\n      default:\n        throw new Error(\"Unsupported alpha mode: \" + mode + \".\");\n    }\n  };\n\n  NativeEngine.prototype._getNativeAttribType = function (type) {\n    switch (type) {\n      case VertexBuffer.UNSIGNED_BYTE:\n        return this._native.ATTRIB_TYPE_UINT8;\n\n      case VertexBuffer.SHORT:\n        return this._native.ATTRIB_TYPE_INT16;\n\n      case VertexBuffer.FLOAT:\n        return this._native.ATTRIB_TYPE_FLOAT;\n\n      default:\n        throw new Error(\"Unsupported attribute type: \" + type + \".\");\n    }\n  };\n\n  return NativeEngine;\n}(Engine);\n\nexport { NativeEngine };","map":{"version":3,"sources":["../../../sourceES6/core/Engines/nativeEngine.ts"],"names":[],"mappings":"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","sourcesContent":["import { Nullable, IndicesArray, DataArray } from \"../types\";\r\nimport { Engine } from \"../Engines/engine\";\r\nimport { VertexBuffer } from \"../Meshes/buffer\";\r\nimport { InternalTexture, InternalTextureSource } from \"../Materials/Textures/internalTexture\";\r\nimport { IInternalTextureLoader } from \"../Materials/Textures/internalTextureLoader\";\r\nimport { Texture } from \"../Materials/Textures/texture\";\r\nimport { BaseTexture } from \"../Materials/Textures/baseTexture\";\r\nimport { VideoTexture } from \"../Materials/Textures/videoTexture\";\r\nimport { RenderTargetTexture } from \"../Materials/Textures/renderTargetTexture\";\r\nimport { Effect } from \"../Materials/effect\";\r\nimport { DataBuffer } from '../Meshes/dataBuffer';\r\nimport { Tools } from \"../Misc/tools\";\r\nimport { Observer } from \"../Misc/observable\";\r\nimport { EnvironmentTextureTools, EnvironmentTextureSpecularInfoV1 } from \"../Misc/environmentTextureTools\";\r\nimport { Matrix, Viewport, Color3 } from \"../Maths/math\";\r\nimport { IColor4Like } from '../Maths/math.like';\r\nimport { Scene } from \"../scene\";\r\nimport { RenderTargetCreationOptions } from \"../Materials/Textures/renderTargetCreationOptions\";\r\nimport { IPipelineContext } from './IPipelineContext';\r\nimport { Logger } from \"../Misc/logger\";\r\n\r\nimport { ThinEngine, ISceneLike } from './thinEngine';\r\nimport { IWebRequest } from '../Misc/interfaces/iWebRequest';\r\nimport { EngineStore } from './engineStore';\r\nimport { ShaderCodeInliner } from \"./Processors/shaderCodeInliner\";\r\nimport { WebGL2ShaderProcessor } from '../Engines/WebGL/webGL2ShaderProcessors';\r\nimport { RenderTargetTextureSize } from '../Engines/Extensions/engine.renderTarget';\r\nimport { DepthTextureCreationOptions } from '../Engines/depthTextureCreationOptions';\r\n\r\ninterface INativeEngine {\r\n\r\n    readonly TEXTURE_NEAREST_NEAREST: number;\r\n    readonly TEXTURE_LINEAR_LINEAR: number;\r\n    readonly TEXTURE_LINEAR_LINEAR_MIPLINEAR: number;\r\n    readonly TEXTURE_NEAREST_NEAREST_MIPNEAREST: number;\r\n    readonly TEXTURE_NEAREST_LINEAR_MIPNEAREST: number;\r\n    readonly TEXTURE_NEAREST_LINEAR_MIPLINEAR: number;\r\n    readonly TEXTURE_NEAREST_LINEAR: number;\r\n    readonly TEXTURE_NEAREST_NEAREST_MIPLINEAR: number;\r\n    readonly TEXTURE_LINEAR_NEAREST_MIPNEAREST: number;\r\n    readonly TEXTURE_LINEAR_NEAREST_MIPLINEAR: number;\r\n    readonly TEXTURE_LINEAR_LINEAR_MIPNEAREST: number;\r\n    readonly TEXTURE_LINEAR_NEAREST: number;\r\n\r\n    readonly DEPTH_TEST_LESS: number;\r\n    readonly DEPTH_TEST_LEQUAL: number;\r\n    readonly DEPTH_TEST_EQUAL: number;\r\n    readonly DEPTH_TEST_GEQUAL: number;\r\n    readonly DEPTH_TEST_GREATER: number;\r\n    readonly DEPTH_TEST_NOTEQUAL: number;\r\n    readonly DEPTH_TEST_NEVER: number;\r\n    readonly DEPTH_TEST_ALWAYS: number;\r\n\r\n    readonly CLEAR_FLAG_COLOR: number;\r\n    readonly CLEAR_FLAG_DEPTH: number;\r\n    readonly CLEAR_FLAG_STENCIL: number;\r\n\r\n    readonly ADDRESS_MODE_WRAP: number;\r\n    readonly ADDRESS_MODE_MIRROR: number;\r\n    readonly ADDRESS_MODE_CLAMP: number;\r\n    readonly ADDRESS_MODE_BORDER: number;\r\n    readonly ADDRESS_MODE_MIRROR_ONCE: number;\r\n\r\n    readonly TEXTURE_FORMAT_RGBA8: number;\r\n    readonly TEXTURE_FORMAT_RGBA32F: number;\r\n\r\n    readonly ATTRIB_TYPE_UINT8: number;\r\n    readonly ATTRIB_TYPE_INT16: number;\r\n    readonly ATTRIB_TYPE_FLOAT: number;\r\n\r\n    readonly ALPHA_DISABLE: number;\r\n    readonly ALPHA_ADD: number;\r\n    readonly ALPHA_COMBINE: number;\r\n    readonly ALPHA_SUBTRACT: number;\r\n    readonly ALPHA_MULTIPLY: number;\r\n    readonly ALPHA_MAXIMIZED: number;\r\n    readonly ALPHA_ONEONE: number;\r\n    readonly ALPHA_PREMULTIPLIED: number;\r\n    readonly ALPHA_PREMULTIPLIED_PORTERDUFF: number;\r\n    readonly ALPHA_INTERPOLATE: number;\r\n    readonly ALPHA_SCREENMODE: number;\r\n\r\n    dispose(): void;\r\n\r\n    requestAnimationFrame(callback: () => void): void;\r\n\r\n    createVertexArray(): any;\r\n    deleteVertexArray(vertexArray: any): void;\r\n    bindVertexArray(vertexArray: any): void;\r\n\r\n    createIndexBuffer(data: ArrayBufferView, dynamic: boolean): any;\r\n    deleteIndexBuffer(buffer: any): void;\r\n    recordIndexBuffer(vertexArray: any, buffer: any): void;\r\n    updateDynamicIndexBuffer(buffer: any, data: ArrayBufferView, startingIndex: number): void;\r\n\r\n    createVertexBuffer(data: ArrayBufferView, dynamic: boolean): any;\r\n    deleteVertexBuffer(buffer: any): void;\r\n    recordVertexBuffer(vertexArray: any, buffer: any, location: number, byteOffset: number, byteStride: number, numElements: number, type: number, normalized: boolean): void;\r\n    updateDynamicVertexBuffer(buffer: any, data: ArrayBufferView, byteOffset: number, byteLength: number): void;\r\n\r\n    createProgram(vertexShader: string, fragmentShader: string): any;\r\n    getUniforms(shaderProgram: any, uniformsNames: string[]): WebGLUniformLocation[];\r\n    getAttributes(shaderProgram: any, attributeNames: string[]): number[];\r\n    setProgram(program: any): void;\r\n\r\n    setState(culling: boolean, zOffset: number, reverseSide: boolean): void;\r\n    setZOffset(zOffset: number): void;\r\n    getZOffset(): number;\r\n    setDepthTest(enable: number): void;\r\n    getDepthWrite(): boolean;\r\n    setDepthWrite(enable: boolean): void;\r\n    setColorWrite(enable: boolean): void;\r\n    setBlendMode(blendMode: number): void;\r\n\r\n    setMatrix(uniform: WebGLUniformLocation, matrix: Float32Array): void;\r\n    setInt(uniform: WebGLUniformLocation, int: number): void;\r\n    setIntArray(uniform: WebGLUniformLocation, array: Int32Array): void;\r\n    setIntArray2(uniform: WebGLUniformLocation, array: Int32Array): void;\r\n    setIntArray3(uniform: WebGLUniformLocation, array: Int32Array): void;\r\n    setIntArray4(uniform: WebGLUniformLocation, array: Int32Array): void;\r\n    setFloatArray(uniform: WebGLUniformLocation, array: Float32Array | number[]): void;\r\n    setFloatArray2(uniform: WebGLUniformLocation, array: Float32Array | number[]): void;\r\n    setFloatArray3(uniform: WebGLUniformLocation, array: Float32Array | number[]): void;\r\n    setFloatArray4(uniform: WebGLUniformLocation, array: Float32Array | number[]): void;\r\n    setMatrices(uniform: WebGLUniformLocation, matrices: Float32Array): void;\r\n    setMatrix3x3(uniform: WebGLUniformLocation, matrix: Float32Array): void;\r\n    setMatrix2x2(uniform: WebGLUniformLocation, matrix: Float32Array): void;\r\n    setFloat(uniform: WebGLUniformLocation, value: number): void;\r\n    setFloat2(uniform: WebGLUniformLocation, x: number, y: number): void;\r\n    setFloat3(uniform: WebGLUniformLocation, x: number, y: number, z: number): void;\r\n    setFloat4(uniform: WebGLUniformLocation, x: number, y: number, z: number, w: number): void;\r\n\r\n    createTexture(): WebGLTexture;\r\n    createDepthTexture(texture: WebGLTexture, width: number, height: number): WebGLTexture;\r\n    loadTexture(texture: WebGLTexture, data: ArrayBufferView, generateMips: boolean, invertY: boolean, onSuccess: () => void, onError: () => void): void;\r\n    loadCubeTexture(texture: WebGLTexture, data: Array<ArrayBufferView>, generateMips: boolean, onSuccess: () => void, onError: () => void): void;\r\n    loadCubeTextureWithMips(texture: WebGLTexture, data: Array<Array<ArrayBufferView>>, onSuccess: () => void, onError: () => void): void;\r\n    getTextureWidth(texture: WebGLTexture): number;\r\n    getTextureHeight(texture: WebGLTexture): number;\r\n    setTextureSampling(texture: WebGLTexture, filter: number): void; // filter is a NativeFilter.XXXX value.\r\n    setTextureWrapMode(texture: WebGLTexture, addressModeU: number, addressModeV: number, addressModeW: number): void; // addressModes are NativeAddressMode.XXXX values.\r\n    setTextureAnisotropicLevel(texture: WebGLTexture, value: number): void;\r\n    setTexture(uniform: WebGLUniformLocation, texture: Nullable<WebGLTexture>): void;\r\n    deleteTexture(texture: Nullable<WebGLTexture>): void;\r\n\r\n    createFramebuffer(texture: WebGLTexture, width: number, height: number, format: number, samplingMode: number, generateStencilBuffer: boolean, generateDepthBuffer: boolean, generateMips: boolean): WebGLFramebuffer;\r\n    deleteFramebuffer(framebuffer: WebGLFramebuffer): void;\r\n    bindFramebuffer(framebuffer: WebGLFramebuffer): void;\r\n    unbindFramebuffer(framebuffer: WebGLFramebuffer): void;\r\n\r\n    drawIndexed(fillMode: number, indexStart: number, indexCount: number): void;\r\n    draw(fillMode: number, vertexStart: number, vertexCount: number): void;\r\n\r\n    clear(flags: number): void;\r\n    clearColor(r: number, g: number, b: number, a: number): void;\r\n    clearDepth(depth: number): void;\r\n    clearStencil(stencil: number): void;\r\n\r\n    getRenderWidth(): number;\r\n    getRenderHeight(): number;\r\n\r\n    setViewPort(x: number, y: number, width: number, height: number): void;\r\n}\r\n\r\nclass NativePipelineContext implements IPipelineContext {\r\n    // TODO: async should be true?\r\n    public isAsync = false;\r\n    public isReady = false;\r\n\r\n    public _getVertexShaderCode(): string | null {\r\n        return null;\r\n    }\r\n\r\n    public _getFragmentShaderCode(): string | null {\r\n        return null;\r\n    }\r\n\r\n    // TODO: what should this do?\r\n    public _handlesSpectorRebuildCallback(onCompiled: (compiledObject: any) => void): void {\r\n        throw new Error(\"Not implemented\");\r\n    }\r\n\r\n    public nativeProgram: any;\r\n}\r\n\r\n/**\r\n * Container for accessors for natively-stored mesh data buffers.\r\n */\r\nclass NativeDataBuffer extends DataBuffer {\r\n    /**\r\n     * Accessor value used to identify/retrieve a natively-stored index buffer.\r\n     */\r\n    public nativeIndexBuffer?: any;\r\n\r\n    /**\r\n     * Accessor value used to identify/retrieve a natively-stored vertex buffer.\r\n     */\r\n    public nativeVertexBuffer?: any;\r\n}\r\n\r\n/** @hidden */\r\nclass NativeTexture extends InternalTexture {\r\n    public getInternalTexture(): InternalTexture {\r\n        return this;\r\n    }\r\n\r\n    public getViewCount(): number {\r\n        return 1;\r\n    }\r\n}\r\n\r\n/** @hidden */\r\ndeclare var _native: any;\r\n\r\n/** @hidden */\r\nexport class NativeEngine extends Engine {\r\n    private readonly _native: INativeEngine = new _native.Engine();\r\n    /** Defines the invalid handle returned by bgfx when resource creation goes wrong */\r\n    private readonly INVALID_HANDLE = 65535;\r\n    private _boundBuffersVertexArray: any = null;\r\n    private _currentDepthTest: number = this._native.DEPTH_TEST_LEQUAL;\r\n\r\n    public getHardwareScalingLevel(): number {\r\n        return 1.0;\r\n    }\r\n\r\n    public constructor() {\r\n        super(null);\r\n\r\n        this._webGLVersion = 2;\r\n        this.disableUniformBuffers = true;\r\n\r\n        // TODO: Initialize this more correctly based on the hardware capabilities.\r\n        // Init caps\r\n\r\n        this._caps = {\r\n            maxTexturesImageUnits: 16,\r\n            maxVertexTextureImageUnits: 16,\r\n            maxCombinedTexturesImageUnits: 32,\r\n            maxTextureSize: 512,\r\n            maxCubemapTextureSize: 512,\r\n            maxRenderTextureSize: 512,\r\n            maxVertexAttribs: 16,\r\n            maxVaryingVectors: 16,\r\n            maxFragmentUniformVectors: 16,\r\n            maxVertexUniformVectors: 16,\r\n            standardDerivatives: true,\r\n            astc: null,\r\n            pvrtc: null,\r\n            etc1: null,\r\n            etc2: null,\r\n            bptc: null,\r\n            maxAnisotropy: 16,  // TODO: Retrieve this smartly. Currently set to D3D11 maximum allowable value.\r\n            uintIndices: true,\r\n            fragmentDepthSupported: false,\r\n            highPrecisionShaderSupported: true,\r\n            colorBufferFloat: false,\r\n            textureFloat: false,\r\n            textureFloatLinearFiltering: false,\r\n            textureFloatRender: false,\r\n            textureHalfFloat: false,\r\n            textureHalfFloatLinearFiltering: false,\r\n            textureHalfFloatRender: false,\r\n            textureLOD: true,\r\n            drawBuffersExtension: false,\r\n            depthTextureExtension: false,\r\n            vertexArrayObject: true,\r\n            instancedArrays: false,\r\n            canUseTimestampForTimerQuery: false,\r\n            blendMinMax: false,\r\n            maxMSAASamples: 1\r\n        };\r\n\r\n        Tools.Log(\"Babylon Native (v\" + Engine.Version + \") launched\");\r\n\r\n        Tools.LoadScript = function (scriptUrl, onSuccess, onError, scriptId) {\r\n            Tools.LoadFile(scriptUrl, (data) => {\r\n                Function(data as string).apply(null);\r\n                if (onSuccess) {\r\n                    onSuccess();\r\n                }\r\n            }, undefined, undefined, false,\r\n            (request, exception) => {\r\n                if (onError) {\r\n                    onError(\"LoadScript Error\", exception);\r\n                }\r\n            });\r\n        };\r\n\r\n        // Wrappers\r\n        if (typeof URL === \"undefined\") {\r\n            (window.URL as any) = {\r\n                createObjectURL: function() { },\r\n                revokeObjectURL: function() { }\r\n            };\r\n        }\r\n\r\n        if (typeof Blob === \"undefined\") {\r\n            (window.Blob as any) = function() { };\r\n        }\r\n\r\n        // Shader processor\r\n        this._shaderProcessor = new WebGL2ShaderProcessor();\r\n    }\r\n\r\n    public dispose(): void {\r\n        super.dispose();\r\n        if (this._boundBuffersVertexArray) {\r\n            this._native.deleteVertexArray(this._boundBuffersVertexArray);\r\n        }\r\n        this._native.dispose();\r\n    }\r\n\r\n    /**\r\n     * Can be used to override the current requestAnimationFrame requester.\r\n     * @hidden\r\n     */\r\n    protected _queueNewFrame(bindedRenderFunction: any, requester?: any): number {\r\n        // Use the provided requestAnimationFrame, unless the requester is the window. In that case, we will default to the Babylon Native version of requestAnimationFrame.\r\n        if (requester.requestAnimationFrame && requester !== window) {\r\n            requester.requestAnimationFrame(bindedRenderFunction);\r\n        } else {\r\n            this._native.requestAnimationFrame(bindedRenderFunction);\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * Override default engine behavior.\r\n     * @param color\r\n     * @param backBuffer\r\n     * @param depth\r\n     * @param stencil\r\n     */\r\n    public _bindUnboundFramebuffer(framebuffer: Nullable<WebGLFramebuffer>) {\r\n        if (this._currentFramebuffer !== framebuffer) {\r\n            if (this._currentFramebuffer) {\r\n                this._native.unbindFramebuffer(this._currentFramebuffer!);\r\n            }\r\n\r\n            if (framebuffer) {\r\n                this._native.bindFramebuffer(framebuffer);\r\n            }\r\n\r\n            this._currentFramebuffer = framebuffer;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets host document\r\n     * @returns the host document object\r\n     */\r\n    public getHostDocument(): Nullable<Document> {\r\n        return null;\r\n    }\r\n\r\n    public clear(color: Nullable<IColor4Like>, backBuffer: boolean, depth: boolean, stencil: boolean = false): void {\r\n        var mode = 0;\r\n        if (backBuffer && color) {\r\n            this._native.clearColor(color.r, color.g, color.b, color.a !== undefined ? color.a : 1.0);\r\n            mode |= this._native.CLEAR_FLAG_COLOR;\r\n        }\r\n        if (depth) {\r\n            this._native.clearDepth(1.0);\r\n            mode |= this._native.CLEAR_FLAG_DEPTH;\r\n        }\r\n        if (stencil) {\r\n            this._native.clearStencil(0);\r\n            mode |= this._native.CLEAR_FLAG_STENCIL;\r\n        }\r\n        this._native.clear(mode);\r\n    }\r\n\r\n    public createIndexBuffer(indices: IndicesArray, updateable?: boolean): NativeDataBuffer {\r\n        const data = this._normalizeIndexData(indices);\r\n        const buffer = new NativeDataBuffer();\r\n        buffer.references = 1;\r\n        buffer.is32Bits = (data.BYTES_PER_ELEMENT === 4);\r\n        if (data.length) {\r\n            buffer.nativeIndexBuffer = this._native.createIndexBuffer(data, updateable ?? false);\r\n            if (buffer.nativeVertexBuffer === this.INVALID_HANDLE) {\r\n                throw new Error(\"Could not create a native index buffer.\");\r\n            }\r\n        } else {\r\n            buffer.nativeVertexBuffer = this.INVALID_HANDLE;\r\n        }\r\n        return buffer;\r\n    }\r\n\r\n    public createVertexBuffer(data: DataArray, updateable?: boolean): NativeDataBuffer {\r\n        const buffer = new NativeDataBuffer();\r\n        buffer.references = 1;\r\n        buffer.nativeVertexBuffer = this._native.createVertexBuffer(ArrayBuffer.isView(data) ? data : new Float32Array(data), updateable ?? false);\r\n        if (buffer.nativeVertexBuffer === this.INVALID_HANDLE) {\r\n            throw new Error(\"Could not create a native vertex buffer.\");\r\n        }\r\n        return buffer;\r\n    }\r\n\r\n    protected _recordVertexArrayObject(vertexArray: any, vertexBuffers: { [key: string]: VertexBuffer; }, indexBuffer: Nullable<NativeDataBuffer>, effect: Effect): void {\r\n        if (indexBuffer) {\r\n            this._native.recordIndexBuffer(vertexArray, indexBuffer.nativeIndexBuffer);\r\n        }\r\n\r\n        const attributes = effect.getAttributesNames();\r\n        for (let index = 0; index < attributes.length; index++) {\r\n            const location = effect.getAttributeLocation(index);\r\n            if (location >= 0) {\r\n                const kind = attributes[index];\r\n                const vertexBuffer = vertexBuffers[kind];\r\n                if (vertexBuffer) {\r\n                    const buffer = vertexBuffer.getBuffer() as Nullable<NativeDataBuffer>;\r\n                    if (buffer) {\r\n                        this._native.recordVertexBuffer(\r\n                            vertexArray,\r\n                            buffer.nativeVertexBuffer,\r\n                            location,\r\n                            vertexBuffer.byteOffset,\r\n                            vertexBuffer.byteStride,\r\n                            vertexBuffer.getSize(),\r\n                            this._getNativeAttribType(vertexBuffer.type),\r\n                            vertexBuffer.normalized);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public bindBuffers(vertexBuffers: { [key: string]: VertexBuffer; }, indexBuffer: Nullable<NativeDataBuffer>, effect: Effect): void {\r\n        if (this._boundBuffersVertexArray) {\r\n            this._native.deleteVertexArray(this._boundBuffersVertexArray);\r\n        }\r\n        this._boundBuffersVertexArray = this._native.createVertexArray();\r\n        this._recordVertexArrayObject(this._boundBuffersVertexArray, vertexBuffers, indexBuffer, effect);\r\n        this._native.bindVertexArray(this._boundBuffersVertexArray);\r\n    }\r\n\r\n    public recordVertexArrayObject(vertexBuffers: { [key: string]: VertexBuffer; }, indexBuffer: Nullable<NativeDataBuffer>, effect: Effect): WebGLVertexArrayObject {\r\n        const vertexArray = this._native.createVertexArray();\r\n        this._recordVertexArrayObject(vertexArray, vertexBuffers, indexBuffer, effect);\r\n        return vertexArray;\r\n    }\r\n\r\n    public bindVertexArrayObject(vertexArray: WebGLVertexArrayObject): void {\r\n        this._native.bindVertexArray(vertexArray);\r\n    }\r\n\r\n    public releaseVertexArrayObject(vertexArray: WebGLVertexArrayObject) {\r\n        this._native.deleteVertexArray(vertexArray);\r\n    }\r\n\r\n    public getAttributes(pipelineContext: IPipelineContext, attributesNames: string[]): number[] {\r\n        const nativePipelineContext = pipelineContext as NativePipelineContext;\r\n        return this._native.getAttributes(nativePipelineContext.nativeProgram, attributesNames);\r\n    }\r\n\r\n    /**\r\n     * Draw a list of indexed primitives\r\n     * @param fillMode defines the primitive to use\r\n     * @param indexStart defines the starting index\r\n     * @param indexCount defines the number of index to draw\r\n     * @param instancesCount defines the number of instances to draw (if instanciation is enabled)\r\n     */\r\n    public drawElementsType(fillMode: number, indexStart: number, indexCount: number, instancesCount?: number): void {\r\n        // Apply states\r\n        this._drawCalls.addCount(1, false);\r\n\r\n        // TODO: Make this implementation more robust like core Engine version.\r\n\r\n        // Render\r\n        //var indexFormat = this._uintIndicesCurrentlySet ? this._gl.UNSIGNED_INT : this._gl.UNSIGNED_SHORT;\r\n\r\n        //var mult = this._uintIndicesCurrentlySet ? 4 : 2;\r\n        // if (instancesCount) {\r\n        //     this._gl.drawElementsInstanced(drawMode, indexCount, indexFormat, indexStart * mult, instancesCount);\r\n        // } else {\r\n        this._native.drawIndexed(fillMode, indexStart, indexCount);\r\n        // }\r\n    }\r\n\r\n    /**\r\n     * Draw a list of unindexed primitives\r\n     * @param fillMode defines the primitive to use\r\n     * @param verticesStart defines the index of first vertex to draw\r\n     * @param verticesCount defines the count of vertices to draw\r\n     * @param instancesCount defines the number of instances to draw (if instanciation is enabled)\r\n     */\r\n    public drawArraysType(fillMode: number, verticesStart: number, verticesCount: number, instancesCount?: number): void {\r\n        // Apply states\r\n        this._drawCalls.addCount(1, false);\r\n\r\n        // TODO: Make this implementation more robust like core Engine version.\r\n\r\n        // if (instancesCount) {\r\n        //     this._gl.drawArraysInstanced(drawMode, verticesStart, verticesCount, instancesCount);\r\n        // } else {\r\n        this._native.draw(fillMode, verticesStart, verticesCount);\r\n        // }\r\n    }\r\n\r\n    public createPipelineContext(): IPipelineContext {\r\n        return new NativePipelineContext();\r\n    }\r\n\r\n    public _preparePipelineContext(pipelineContext: IPipelineContext, vertexSourceCode: string, fragmentSourceCode: string, createAsRaw: boolean, rebuildRebind: any, defines: Nullable<string>, transformFeedbackVaryings: Nullable<string[]>) {\r\n        const nativePipelineContext = pipelineContext as NativePipelineContext;\r\n\r\n        if (createAsRaw) {\r\n            nativePipelineContext.nativeProgram = this.createRawShaderProgram(pipelineContext, vertexSourceCode, fragmentSourceCode, undefined, transformFeedbackVaryings);\r\n        }\r\n        else {\r\n            nativePipelineContext.nativeProgram = this.createShaderProgram(pipelineContext, vertexSourceCode, fragmentSourceCode, defines, undefined, transformFeedbackVaryings);\r\n        }\r\n    }\r\n\r\n    /** @hidden */\r\n    public _isRenderingStateCompiled(pipelineContext: IPipelineContext): boolean {\r\n        // TODO: support async shader compilcation\r\n        return true;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _executeWhenRenderingStateIsCompiled(pipelineContext: IPipelineContext, action: () => void) {\r\n        // TODO: support async shader compilcation\r\n        action();\r\n    }\r\n\r\n    public createRawShaderProgram(pipelineContext: IPipelineContext, vertexCode: string, fragmentCode: string, context?: WebGLRenderingContext, transformFeedbackVaryings: Nullable<string[]> = null): any {\r\n        throw new Error(\"Not Supported\");\r\n    }\r\n\r\n    public createShaderProgram(pipelineContext: IPipelineContext, vertexCode: string, fragmentCode: string, defines: Nullable<string>, context?: WebGLRenderingContext, transformFeedbackVaryings: Nullable<string[]> = null): any {\r\n        this.onBeforeShaderCompilationObservable.notifyObservers(this);\r\n\r\n        const vertexInliner = new ShaderCodeInliner(vertexCode);\r\n        vertexInliner.processCode();\r\n        vertexCode = vertexInliner.code;\r\n\r\n        const fragmentInliner = new ShaderCodeInliner(fragmentCode);\r\n        fragmentInliner.processCode();\r\n        fragmentCode = fragmentInliner.code;\r\n\r\n        vertexCode = ThinEngine._ConcatenateShader(vertexCode, defines);\r\n        fragmentCode = ThinEngine._ConcatenateShader(fragmentCode, defines);\r\n\r\n        const program = this._native.createProgram(vertexCode, fragmentCode);\r\n        this.onAfterShaderCompilationObservable.notifyObservers(this);\r\n        return program;\r\n    }\r\n\r\n    protected _setProgram(program: WebGLProgram): void {\r\n        if (this._currentProgram !== program) {\r\n            this._native.setProgram(program);\r\n            this._currentProgram = program;\r\n        }\r\n    }\r\n\r\n    public _releaseEffect(effect: Effect): void {\r\n        // TODO\r\n    }\r\n\r\n    public _deletePipelineContext(pipelineContext: IPipelineContext): void {\r\n        // TODO\r\n    }\r\n\r\n    public getUniforms(pipelineContext: IPipelineContext, uniformsNames: string[]): WebGLUniformLocation[] {\r\n        const nativePipelineContext = pipelineContext as NativePipelineContext;\r\n        return this._native.getUniforms(nativePipelineContext.nativeProgram, uniformsNames);\r\n    }\r\n\r\n    public bindUniformBlock(pipelineContext: IPipelineContext, blockName: string, index: number): void {\r\n        // TODO\r\n        throw new Error(\"Not Implemented\");\r\n    }\r\n\r\n    public bindSamplers(effect: Effect): void {\r\n        const nativePipelineContext = effect.getPipelineContext() as NativePipelineContext;\r\n        this._setProgram(nativePipelineContext.nativeProgram);\r\n\r\n        // TODO: share this with engine?\r\n        var samplers = effect.getSamplers();\r\n        for (var index = 0; index < samplers.length; index++) {\r\n            var uniform = effect.getUniform(samplers[index]);\r\n\r\n            if (uniform) {\r\n                this._boundUniforms[index] = uniform;\r\n            }\r\n        }\r\n        this._currentEffect = null;\r\n    }\r\n\r\n    public setMatrix(uniform: WebGLUniformLocation, matrix: Matrix): void {\r\n        if (!uniform) {\r\n            return;\r\n        }\r\n\r\n        this._native.setMatrix(uniform, matrix.toArray() as Float32Array);\r\n    }\r\n\r\n    public getRenderWidth(useScreen = false): number {\r\n        if (!useScreen && this._currentRenderTarget) {\r\n            return this._currentRenderTarget.width;\r\n        }\r\n\r\n        return this._native.getRenderWidth();\r\n    }\r\n\r\n    public getRenderHeight(useScreen = false): number {\r\n        if (!useScreen && this._currentRenderTarget) {\r\n            return this._currentRenderTarget.height;\r\n        }\r\n\r\n        return this._native.getRenderHeight();\r\n    }\r\n\r\n    public setViewport(viewport: Viewport, requiredWidth?: number, requiredHeight?: number): void {\r\n        this._cachedViewport = viewport;\r\n        this._native.setViewPort(viewport.x, viewport.y, viewport.width, viewport.height);\r\n    }\r\n\r\n    public setState(culling: boolean, zOffset: number = 0, force?: boolean, reverseSide = false): void {\r\n        this._native.setState(culling, zOffset, reverseSide);\r\n    }\r\n\r\n    /**\r\n     * Set the z offset to apply to current rendering\r\n     * @param value defines the offset to apply\r\n     */\r\n    public setZOffset(value: number): void {\r\n        this._native.setZOffset(value);\r\n    }\r\n\r\n    /**\r\n     * Gets the current value of the zOffset\r\n     * @returns the current zOffset state\r\n     */\r\n    public getZOffset(): number {\r\n        return this._native.getZOffset();\r\n    }\r\n\r\n    /**\r\n     * Enable or disable depth buffering\r\n     * @param enable defines the state to set\r\n     */\r\n    public setDepthBuffer(enable: boolean): void {\r\n        this._native.setDepthTest(enable ? this._currentDepthTest : this._native.DEPTH_TEST_ALWAYS);\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if depth writing is enabled\r\n     * @returns the current depth writing state\r\n     */\r\n    public getDepthWrite(): boolean {\r\n        return this._native.getDepthWrite();\r\n    }\r\n\r\n    public setDepthFunctionToGreater(): void {\r\n        this._currentDepthTest = this._native.DEPTH_TEST_GREATER;\r\n        this._native.setDepthTest(this._currentDepthTest);\r\n    }\r\n\r\n    public setDepthFunctionToGreaterOrEqual(): void {\r\n        this._currentDepthTest = this._native.DEPTH_TEST_GEQUAL;\r\n        this._native.setDepthTest(this._currentDepthTest);\r\n    }\r\n\r\n    public setDepthFunctionToLess(): void {\r\n        this._currentDepthTest = this._native.DEPTH_TEST_LESS;\r\n        this._native.setDepthTest(this._currentDepthTest);\r\n    }\r\n\r\n    public setDepthFunctionToLessOrEqual(): void {\r\n        this._currentDepthTest = this._native.DEPTH_TEST_LEQUAL;\r\n        this._native.setDepthTest(this._currentDepthTest);\r\n    }\r\n\r\n    /**\r\n     * Enable or disable depth writing\r\n     * @param enable defines the state to set\r\n     */\r\n    public setDepthWrite(enable: boolean): void {\r\n        this._native.setDepthWrite(enable);\r\n    }\r\n\r\n    /**\r\n     * Enable or disable color writing\r\n     * @param enable defines the state to set\r\n     */\r\n    public setColorWrite(enable: boolean): void {\r\n        this._native.setColorWrite(enable);\r\n        this._colorWrite = enable;\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if color writing is enabled\r\n     * @returns the current color writing state\r\n     */\r\n    public getColorWrite(): boolean {\r\n        return this._colorWrite;\r\n    }\r\n\r\n    /**\r\n     * Sets alpha constants used by some alpha blending modes\r\n     * @param r defines the red component\r\n     * @param g defines the green component\r\n     * @param b defines the blue component\r\n     * @param a defines the alpha component\r\n     */\r\n    public setAlphaConstants(r: number, g: number, b: number, a: number) {\r\n        throw new Error(\"Setting alpha blend constant color not yet implemented.\");\r\n    }\r\n\r\n    /**\r\n     * Sets the current alpha mode\r\n     * @param mode defines the mode to use (one of the BABYLON.undefined)\r\n     * @param noDepthWriteChange defines if depth writing state should remains unchanged (false by default)\r\n     * @see https://doc.babylonjs.com/resources/transparency_and_how_meshes_are_rendered\r\n     */\r\n    public setAlphaMode(mode: number, noDepthWriteChange: boolean = false): void {\r\n        if (this._alphaMode === mode) {\r\n            return;\r\n        }\r\n\r\n        mode = this._getNativeAlphaMode(mode);\r\n\r\n        this._native.setBlendMode(mode);\r\n\r\n        if (!noDepthWriteChange) {\r\n            this.setDepthWrite(mode === 0);\r\n        }\r\n\r\n        this._alphaMode = mode;\r\n    }\r\n\r\n    /**\r\n     * Gets the current alpha mode\r\n     * @see https://doc.babylonjs.com/resources/transparency_and_how_meshes_are_rendered\r\n     * @returns the current alpha mode\r\n     */\r\n    public getAlphaMode(): number {\r\n        return this._alphaMode;\r\n    }\r\n\r\n    public setInt(uniform: WebGLUniformLocation, int: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setInt(uniform, int);\r\n        return true;\r\n    }\r\n\r\n    public setIntArray(uniform: WebGLUniformLocation, array: Int32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setIntArray(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    public setIntArray2(uniform: WebGLUniformLocation, array: Int32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setIntArray2(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    public setIntArray3(uniform: WebGLUniformLocation, array: Int32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setIntArray3(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    public setIntArray4(uniform: WebGLUniformLocation, array: Int32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setIntArray4(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    public setFloatArray(uniform: WebGLUniformLocation, array: Float32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setFloatArray(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    public setFloatArray2(uniform: WebGLUniformLocation, array: Float32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setFloatArray2(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    public setFloatArray3(uniform: WebGLUniformLocation, array: Float32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setFloatArray3(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    public setFloatArray4(uniform: WebGLUniformLocation, array: Float32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setFloatArray4(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    public setArray(uniform: WebGLUniformLocation, array: number[]): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setFloatArray(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    public setArray2(uniform: WebGLUniformLocation, array: number[]): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setFloatArray2(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    public setArray3(uniform: WebGLUniformLocation, array: number[]): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setFloatArray3(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    public setArray4(uniform: WebGLUniformLocation, array: number[]): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setFloatArray4(uniform, array);\r\n        return true;\r\n    }\r\n\r\n    public setMatrices(uniform: WebGLUniformLocation, matrices: Float32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setMatrices(uniform, matrices);\r\n        return true;\r\n    }\r\n\r\n    public setMatrix3x3(uniform: WebGLUniformLocation, matrix: Float32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setMatrix3x3(uniform, matrix);\r\n        return true;\r\n    }\r\n\r\n    public setMatrix2x2(uniform: WebGLUniformLocation, matrix: Float32Array): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setMatrix2x2(uniform, matrix);\r\n        return true;\r\n    }\r\n\r\n    public setFloat(uniform: WebGLUniformLocation, value: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setFloat(uniform, value);\r\n        return true;\r\n    }\r\n\r\n    public setFloat2(uniform: WebGLUniformLocation, x: number, y: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setFloat2(uniform, x, y);\r\n        return true;\r\n    }\r\n\r\n    public setFloat3(uniform: WebGLUniformLocation, x: number, y: number, z: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setFloat3(uniform, x, y, z);\r\n        return true;\r\n    }\r\n\r\n    public setFloat4(uniform: WebGLUniformLocation, x: number, y: number, z: number, w: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setFloat4(uniform, x, y, z, w);\r\n        return true;\r\n    }\r\n\r\n    public setColor3(uniform: WebGLUniformLocation, color3: Color3): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setFloat3(uniform, color3.r, color3.g, color3.b);\r\n        return true;\r\n    }\r\n\r\n    public setColor4(uniform: WebGLUniformLocation, color3: Color3, alpha: number): boolean {\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setFloat4(uniform, color3.r, color3.g, color3.b, alpha);\r\n        return true;\r\n    }\r\n\r\n    public wipeCaches(bruteForce?: boolean): void {\r\n        if (this.preventCacheWipeBetweenFrames) {\r\n            return;\r\n        }\r\n        this.resetTextureCache();\r\n        this._currentEffect = null;\r\n\r\n        if (bruteForce) {\r\n            this._currentProgram = null;\r\n\r\n            this._stencilState.reset();\r\n            this._depthCullingState.reset();\r\n            this._alphaState.reset();\r\n        }\r\n\r\n        this._cachedVertexBuffers = null;\r\n        this._cachedIndexBuffer = null;\r\n        this._cachedEffectForVertexBuffers = null;\r\n    }\r\n\r\n    public _createTexture(): WebGLTexture {\r\n        return this._native.createTexture();\r\n    }\r\n\r\n    protected _deleteTexture(texture: Nullable<WebGLTexture>): void {\r\n        this._native.deleteTexture(texture);\r\n    }\r\n\r\n    /**\r\n     * Update the content of a dynamic texture\r\n     * @param texture defines the texture to update\r\n     * @param canvas defines the canvas containing the source\r\n     * @param invertY defines if data must be stored with Y axis inverted\r\n     * @param premulAlpha defines if alpha is stored as premultiplied\r\n     * @param format defines the format of the data\r\n     * @param forceBindTexture if the texture should be forced to be bound eg. after a graphics context loss (Default: false)\r\n     */\r\n    public updateDynamicTexture(texture: Nullable<InternalTexture>, canvas: HTMLCanvasElement, invertY: boolean, premulAlpha: boolean = false, format?: number): void {\r\n        // TODO: Stub! This function is needed for some GLTF validation tests.\r\n        // Loads a dummy 8x8 transparent png\r\n        var imageData = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYSURBVChTY/z//z8DPsAEpXGC4aCAgQEAGGMDDWwwgqsAAAAASUVORK5CYII=';\r\n        this.createTexture('data:my_image_name', true, invertY, null, Texture.BILINEAR_SAMPLINGMODE, undefined, undefined, imageData, texture, NativeEngine.TEXTUREFORMAT_RGBA, null, undefined);\r\n    }\r\n\r\n    // TODO: Refactor to share more logic with babylon.engine.ts version.\r\n    /**\r\n     * Usually called from Texture.ts.\r\n     * Passed information to create a WebGLTexture\r\n     * @param url defines a value which contains one of the following:\r\n     * * A conventional http URL, e.g. 'http://...' or 'file://...'\r\n     * * A base64 string of in-line texture data, e.g. 'data:image/jpg;base64,/...'\r\n     * * An indicator that data being passed using the buffer parameter, e.g. 'data:mytexture.jpg'\r\n     * @param noMipmap defines a boolean indicating that no mipmaps shall be generated.  Ignored for compressed textures.  They must be in the file\r\n     * @param invertY when true, image is flipped when loaded.  You probably want true. Certain compressed textures may invert this if their default is inverted (eg. ktx)\r\n     * @param scene needed for loading to the correct scene\r\n     * @param samplingMode mode with should be used sample / access the texture (Default: Texture.TRILINEAR_SAMPLINGMODE)\r\n     * @param onLoad optional callback to be called upon successful completion\r\n     * @param onError optional callback to be called upon failure\r\n     * @param buffer a source of a file previously fetched as either a base64 string, an ArrayBuffer (compressed or image format), HTMLImageElement (image format), or a Blob\r\n     * @param fallback an internal argument in case the function must be called again, due to etc1 not having alpha capabilities\r\n     * @param format internal format.  Default: RGB when extension is '.jpg' else RGBA.  Ignored for compressed textures\r\n     * @param forcedExtension defines the extension to use to pick the right loader\r\n     * @param mimeType defines an optional mime type\r\n     * @param loaderOptions options to be passed to the loader\r\n     * @returns a InternalTexture for assignment back into BABYLON.Texture\r\n     */\r\n    public createTexture(url: Nullable<string>, noMipmap: boolean, invertY: boolean, scene: Nullable<ISceneLike>, samplingMode: number = 3,\r\n        onLoad: Nullable<() => void> = null, onError: Nullable<(message: string, exception: any) => void> = null,\r\n        buffer: Nullable<string | ArrayBuffer | ArrayBufferView | HTMLImageElement | Blob | ImageBitmap> = null, fallback: Nullable<InternalTexture> = null, format: Nullable<number> = null,\r\n        forcedExtension: Nullable<string> = null, mimeType?: string, loaderOptions?: any): InternalTexture {\r\n        url = url || \"\";\r\n        const fromData = url.substr(0, 5) === \"data:\";\r\n        //const fromBlob = url.substr(0, 5) === \"blob:\";\r\n        const isBase64 = fromData && url.indexOf(\";base64,\") !== -1;\r\n\r\n        let texture = fallback ? fallback : new InternalTexture(this, InternalTextureSource.Url);\r\n\r\n        const originalUrl = url;\r\n        if (this._transformTextureUrl && !isBase64 && !fallback && !buffer) {\r\n            url = this._transformTextureUrl(url);\r\n        }\r\n\r\n        // establish the file extension, if possible\r\n        var lastDot = url.lastIndexOf('.');\r\n        var extension = forcedExtension ? forcedExtension : (lastDot > -1 ? url.substring(lastDot).toLowerCase() : \"\");\r\n\r\n        let loader: Nullable<IInternalTextureLoader> = null;\r\n        for (let availableLoader of Engine._TextureLoaders) {\r\n            if (availableLoader.canLoad(extension)) {\r\n                loader = availableLoader;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (scene) {\r\n            scene._addPendingData(texture);\r\n        }\r\n        texture.url = url;\r\n        texture.generateMipMaps = !noMipmap;\r\n        texture.samplingMode = samplingMode;\r\n        texture.invertY = invertY;\r\n\r\n        if (!this.doNotHandleContextLost) {\r\n            // Keep a link to the buffer only if we plan to handle context lost\r\n            texture._buffer = buffer;\r\n        }\r\n\r\n        let onLoadObserver: Nullable<Observer<InternalTexture>> = null;\r\n        if (onLoad && !fallback) {\r\n            onLoadObserver = texture.onLoadedObservable.add(onLoad);\r\n        }\r\n\r\n        if (!fallback) { this._internalTexturesCache.push(texture); }\r\n\r\n        let onInternalError = (message?: string, exception?: any) => {\r\n            if (scene) {\r\n                scene._removePendingData(texture);\r\n            }\r\n\r\n            if (url === originalUrl) {\r\n                if (onLoadObserver) {\r\n                    texture.onLoadedObservable.remove(onLoadObserver);\r\n                }\r\n\r\n                if (EngineStore.UseFallbackTexture) {\r\n                    this.createTexture(EngineStore.FallbackTexture, noMipmap, texture.invertY, scene, samplingMode, null, onError, buffer, texture);\r\n                }\r\n\r\n                if (onError) {\r\n                    onError((message || \"Unknown error\") + (EngineStore.UseFallbackTexture ? \" - Fallback texture was used\" : \"\"), exception);\r\n                }\r\n            }\r\n            else {\r\n                // fall back to the original url if the transformed url fails to load\r\n                Logger.Warn(`Failed to load ${url}, falling back to ${originalUrl}`);\r\n                this.createTexture(originalUrl, noMipmap, texture.invertY, scene, samplingMode, onLoad, onError, buffer, texture, format, forcedExtension, mimeType, loaderOptions);\r\n            }\r\n        };\r\n\r\n        // processing for non-image formats\r\n        if (loader) {\r\n            throw new Error(\"Loading textures from IInternalTextureLoader not yet implemented.\");\r\n        } else {\r\n            const onload = (data: ArrayBufferView) => {\r\n                const webGLTexture = texture._webGLTexture;\r\n                if (!webGLTexture) {\r\n                    if (scene) {\r\n                        scene._removePendingData(texture);\r\n                    }\r\n\r\n                    return;\r\n                }\r\n\r\n                this._native.loadTexture(webGLTexture, data, !noMipmap, invertY, () => {\r\n                    texture.baseWidth = this._native.getTextureWidth(webGLTexture);\r\n                    texture.baseHeight = this._native.getTextureHeight(webGLTexture);\r\n                    texture.width = texture.baseWidth;\r\n                    texture.height = texture.baseHeight;\r\n                    texture.isReady = true;\r\n\r\n                    var filter = this._getNativeSamplingMode(samplingMode);\r\n                    this._native.setTextureSampling(webGLTexture, filter);\r\n\r\n                    if (scene) {\r\n                        scene._removePendingData(texture);\r\n                    }\r\n\r\n                    texture.onLoadedObservable.notifyObservers(texture);\r\n                    texture.onLoadedObservable.clear();\r\n                }, () => {\r\n                    throw new Error(\"Could not load a native texture.\");\r\n                });\r\n            };\r\n\r\n            if (fromData) {\r\n                if (buffer instanceof ArrayBuffer) {\r\n                    onload(new Uint8Array(buffer));\r\n                } else if (ArrayBuffer.isView(buffer)) {\r\n                    onload(buffer);\r\n                } else if (typeof buffer === \"string\") {\r\n                    onload(new Uint8Array(Tools.DecodeBase64(buffer)));\r\n                } else {\r\n                    throw new Error(\"Unsupported buffer type\");\r\n                }\r\n            }\r\n            else {\r\n                if (isBase64) {\r\n                    onload(new Uint8Array(Tools.DecodeBase64(url)));\r\n                }\r\n                else {\r\n                    this._loadFile(url, (data) => onload(new Uint8Array(data as ArrayBuffer)), undefined, undefined, true, (request?: IWebRequest, exception?: any) => {\r\n                        onInternalError(\"Unable to load \" + (request ? request.responseURL : url, exception));\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        return texture;\r\n    }\r\n\r\n    _createDepthStencilTexture(size: RenderTargetTextureSize, options: DepthTextureCreationOptions): NativeTexture {\r\n        var texture = new NativeTexture(this, InternalTextureSource.Depth);\r\n\r\n        const width = (<{ width: number, height: number, layers?: number }>size).width || <number>size;\r\n        const height = (<{ width: number, height: number, layers?: number }>size).height || <number>size;\r\n\r\n        var framebuffer = this._native.createDepthTexture(\r\n            texture._webGLTexture!,\r\n            width,\r\n            height);\r\n\r\n        texture._framebuffer = framebuffer;\r\n        return texture;\r\n    }\r\n\r\n    public _releaseFramebufferObjects(texture: InternalTexture): void {\r\n        // TODO\r\n    }\r\n\r\n    /**\r\n     * Creates a cube texture\r\n     * @param rootUrl defines the url where the files to load is located\r\n     * @param scene defines the current scene\r\n     * @param files defines the list of files to load (1 per face)\r\n     * @param noMipmap defines a boolean indicating that no mipmaps shall be generated (false by default)\r\n     * @param onLoad defines an optional callback raised when the texture is loaded\r\n     * @param onError defines an optional callback raised if there is an issue to load the texture\r\n     * @param format defines the format of the data\r\n     * @param forcedExtension defines the extension to use to pick the right loader\r\n     * @param createPolynomials if a polynomial sphere should be created for the cube texture\r\n     * @param lodScale defines the scale applied to environment texture. This manages the range of LOD level used for IBL according to the roughness\r\n     * @param lodOffset defines the offset applied to environment texture. This manages first LOD level used for IBL according to the roughness\r\n     * @param fallback defines texture to use while falling back when (compressed) texture file not found.\r\n     * @returns the cube texture as an InternalTexture\r\n     */\r\n    public createCubeTexture(\r\n        rootUrl: string,\r\n        scene: Nullable<Scene>,\r\n        files: Nullable<string[]>,\r\n        noMipmap?: boolean,\r\n        onLoad: Nullable<(data?: any) => void> = null,\r\n        onError: Nullable<(message?: string, exception?: any) => void> = null,\r\n        format?: number,\r\n        forcedExtension: any = null,\r\n        createPolynomials = false,\r\n        lodScale: number = 0,\r\n        lodOffset: number = 0,\r\n        fallback: Nullable<InternalTexture> = null): InternalTexture\r\n    {\r\n        var texture = fallback ? fallback : new InternalTexture(this, InternalTextureSource.Cube);\r\n        texture.isCube = true;\r\n        texture.url = rootUrl;\r\n        texture.generateMipMaps = !noMipmap;\r\n        texture._lodGenerationScale = lodScale;\r\n        texture._lodGenerationOffset = lodOffset;\r\n\r\n        if (!this._doNotHandleContextLost) {\r\n            texture._extension = forcedExtension;\r\n            texture._files = files;\r\n        }\r\n\r\n        var lastDot = rootUrl.lastIndexOf('.');\r\n        var extension = forcedExtension ? forcedExtension : (lastDot > -1 ? rootUrl.substring(lastDot).toLowerCase() : \"\");\r\n\r\n        // TODO: use texture loader to load env files?\r\n        if (extension === \".env\") {\r\n            const onloaddata = (data: ArrayBufferView) => {\r\n                var info = EnvironmentTextureTools.GetEnvInfo(data)!;\r\n                texture.width = info.width;\r\n                texture.height = info.width;\r\n\r\n                EnvironmentTextureTools.UploadEnvSpherical(texture, info);\r\n\r\n                if (info.version !== 1) {\r\n                    throw new Error(`Unsupported babylon environment map version \"${info.version}\"`);\r\n                }\r\n\r\n                let specularInfo = info.specular as EnvironmentTextureSpecularInfoV1;\r\n                if (!specularInfo) {\r\n                    throw new Error(`Nothing else parsed so far`);\r\n                }\r\n\r\n                texture._lodGenerationScale = specularInfo.lodGenerationScale;\r\n                const imageData = EnvironmentTextureTools.CreateImageDataArrayBufferViews(data, info);\r\n\r\n                texture.format = 5;\r\n                texture.type = 0;\r\n                texture.generateMipMaps = true;\r\n                texture.getEngine().updateTextureSamplingMode(Texture.TRILINEAR_SAMPLINGMODE, texture);\r\n                texture._isRGBD = true;\r\n                texture.invertY = true;\r\n\r\n                this._native.loadCubeTextureWithMips(texture._webGLTexture!, imageData, () => {\r\n                    texture.isReady = true;\r\n                    if (onLoad) {\r\n                        onLoad();\r\n                    }\r\n                }, () => {\r\n                    throw new Error(\"Could not load a native cube texture.\");\r\n                });\r\n            };\r\n\r\n            if (files && files.length === 6) {\r\n                throw new Error(`Multi-file loading not allowed on env files.`);\r\n            }\r\n            else {\r\n                let onInternalError = (request?: IWebRequest, exception?: any) => {\r\n                    if (onError && request) {\r\n                        onError(request.status + \" \" + request.statusText, exception);\r\n                    }\r\n                };\r\n\r\n                this._loadFile(rootUrl, (data) => onloaddata(new Uint8Array(data as ArrayBuffer)), undefined, undefined, true, onInternalError);\r\n            }\r\n        }\r\n        else {\r\n            if (!files || files.length !== 6) {\r\n                throw new Error(\"Cannot load cubemap because 6 files were not defined\");\r\n            }\r\n\r\n            // Reorder from [+X, +Y, +Z, -X, -Y, -Z] to [+X, -X, +Y, -Y, +Z, -Z].\r\n            const reorderedFiles = [files[0], files[3], files[1], files[4], files[2], files[5]];\r\n            Promise.all(reorderedFiles.map((file) => Tools.LoadFileAsync(file).then((data) => new Uint8Array(data as ArrayBuffer)))).then((data) => {\r\n                return new Promise((resolve, reject) => {\r\n                    this._native.loadCubeTexture(texture._webGLTexture!, data, !noMipmap, resolve, reject);\r\n                });\r\n            }).then(() => {\r\n                texture.isReady = true;\r\n                if (onLoad) {\r\n                    onLoad();\r\n                }\r\n            }, (error) => {\r\n                if (onError) {\r\n                    onError(`Failed to load cubemap: ${error.message}`, error);\r\n                }\r\n            });\r\n        }\r\n\r\n        this._internalTexturesCache.push(texture);\r\n\r\n        return texture;\r\n    }\r\n\r\n    public createRenderTargetTexture(size: number | { width: number, height: number }, options: boolean | RenderTargetCreationOptions): NativeTexture {\r\n        let fullOptions = new RenderTargetCreationOptions();\r\n\r\n        if (options !== undefined && typeof options === \"object\") {\r\n            fullOptions.generateMipMaps = options.generateMipMaps;\r\n            fullOptions.generateDepthBuffer = options.generateDepthBuffer === undefined ? true : options.generateDepthBuffer;\r\n            fullOptions.generateStencilBuffer = fullOptions.generateDepthBuffer && options.generateStencilBuffer;\r\n            fullOptions.type = options.type === undefined ? 0 : options.type;\r\n            fullOptions.samplingMode = options.samplingMode === undefined ? 3 : options.samplingMode;\r\n            fullOptions.format = options.format === undefined ? 5 : options.format;\r\n        } else {\r\n            fullOptions.generateMipMaps = <boolean>options;\r\n            fullOptions.generateDepthBuffer = true;\r\n            fullOptions.generateStencilBuffer = false;\r\n            fullOptions.type = 0;\r\n            fullOptions.samplingMode = 3;\r\n            fullOptions.format = 5;\r\n        }\r\n\r\n        if (fullOptions.type === 1 && !this._caps.textureFloatLinearFiltering) {\r\n            // if floating point linear (gl.FLOAT) then force to NEAREST_SAMPLINGMODE\r\n            fullOptions.samplingMode = 1;\r\n        }\r\n        else if (fullOptions.type === 2 && !this._caps.textureHalfFloatLinearFiltering) {\r\n            // if floating point linear (HALF_FLOAT) then force to NEAREST_SAMPLINGMODE\r\n            fullOptions.samplingMode = 1;\r\n        }\r\n        var texture = new NativeTexture(this, InternalTextureSource.RenderTarget);\r\n\r\n        var width = (<{ width: number, height: number }>size).width || <number>size;\r\n        var height = (<{ width: number, height: number }>size).height || <number>size;\r\n\r\n        if (fullOptions.type === 1 && !this._caps.textureFloat) {\r\n            fullOptions.type = 0;\r\n            Logger.Warn(\"Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type\");\r\n        }\r\n\r\n        var framebuffer = this._native.createFramebuffer(\r\n            texture._webGLTexture!,\r\n            width,\r\n            height,\r\n            this._getNativeTextureFormat(fullOptions.format, fullOptions.type),\r\n            fullOptions.samplingMode!,\r\n            fullOptions.generateStencilBuffer ? true : false,\r\n            fullOptions.generateDepthBuffer,\r\n            fullOptions.generateMipMaps ? true : false);\r\n\r\n        texture._framebuffer = framebuffer;\r\n        texture.baseWidth = width;\r\n        texture.baseHeight = height;\r\n        texture.width = width;\r\n        texture.height = height;\r\n        texture.isReady = true;\r\n        texture.samples = 1;\r\n        texture.generateMipMaps = fullOptions.generateMipMaps ? true : false;\r\n        texture.samplingMode = fullOptions.samplingMode;\r\n        texture.type = fullOptions.type;\r\n        texture.format = fullOptions.format;\r\n        texture._generateDepthBuffer = fullOptions.generateDepthBuffer;\r\n        texture._generateStencilBuffer = fullOptions.generateStencilBuffer ? true : false;\r\n\r\n        this._internalTexturesCache.push(texture);\r\n\r\n        return texture;\r\n    }\r\n\r\n    public updateTextureSamplingMode(samplingMode: number, texture: InternalTexture): void {\r\n        if (texture._webGLTexture) {\r\n            var filter = this._getNativeSamplingMode(samplingMode);\r\n            this._native.setTextureSampling(texture._webGLTexture, filter);\r\n        }\r\n        texture.samplingMode = samplingMode;\r\n    }\r\n\r\n    public bindFramebuffer(texture: InternalTexture, faceIndex?: number, requiredWidth?: number, requiredHeight?: number, forceFullscreenViewport?: boolean): void {\r\n        if (faceIndex) {\r\n            throw new Error(\"Cuboid frame buffers are not yet supported in NativeEngine.\");\r\n        }\r\n\r\n        if (requiredWidth || requiredHeight) {\r\n            throw new Error(\"Required width/height for frame buffers not yet supported in NativeEngine.\");\r\n        }\r\n\r\n        if (forceFullscreenViewport) {\r\n            //Not supported yet but don't stop rendering\r\n        }\r\n\r\n        if (texture._depthStencilTexture) {\r\n            this._bindUnboundFramebuffer(texture._depthStencilTexture._framebuffer);\r\n        } else {\r\n            this._bindUnboundFramebuffer(texture._framebuffer);\r\n        }\r\n    }\r\n\r\n    public unBindFramebuffer(texture: InternalTexture, disableGenerateMipMaps = false, onBeforeUnbind?: () => void): void {\r\n        if (disableGenerateMipMaps) {\r\n            Logger.Warn(\"Disabling mipmap generation not yet supported in NativeEngine. Ignoring.\");\r\n        }\r\n\r\n        if (onBeforeUnbind) {\r\n            onBeforeUnbind();\r\n        }\r\n\r\n        this._bindUnboundFramebuffer(null);\r\n    }\r\n\r\n    public createDynamicVertexBuffer(data: DataArray): DataBuffer {\r\n        return this.createVertexBuffer(data, true);\r\n    }\r\n\r\n    public updateDynamicIndexBuffer(indexBuffer: DataBuffer, indices: IndicesArray, offset: number = 0): void {\r\n        const buffer = indexBuffer as NativeDataBuffer;\r\n        const data = this._normalizeIndexData(indices);\r\n        buffer.is32Bits = (data.BYTES_PER_ELEMENT === 4);\r\n        this._native.updateDynamicIndexBuffer(buffer.nativeIndexBuffer, data, offset);\r\n    }\r\n\r\n    /**\r\n     * Updates a dynamic vertex buffer.\r\n     * @param vertexBuffer the vertex buffer to update\r\n     * @param data the data used to update the vertex buffer\r\n     * @param byteOffset the byte offset of the data (optional)\r\n     * @param byteLength the byte length of the data (optional)\r\n     */\r\n    public updateDynamicVertexBuffer(vertexBuffer: DataBuffer, data: DataArray, byteOffset?: number, byteLength?: number): void {\r\n        const buffer = vertexBuffer as NativeDataBuffer;\r\n        const dataView = ArrayBuffer.isView(data) ? data : new Float32Array(data);\r\n        this._native.updateDynamicVertexBuffer(\r\n            buffer.nativeVertexBuffer,\r\n            dataView,\r\n            byteOffset ?? 0,\r\n            byteLength ?? dataView.byteLength);\r\n    }\r\n\r\n    // TODO: Refactor to share more logic with base Engine implementation.\r\n    protected _setTexture(channel: number, texture: Nullable<BaseTexture>, isPartOfTextureArray = false, depthStencilTexture = false): boolean {\r\n        let uniform = this._boundUniforms[channel];\r\n        if (!uniform) {\r\n            return false;\r\n        }\r\n\r\n        // Not ready?\r\n        if (!texture) {\r\n            if (this._boundTexturesCache[channel] != null) {\r\n                this._activeChannel = channel;\r\n                this._native.setTexture(uniform, null);\r\n            }\r\n            return false;\r\n        }\r\n\r\n        // Video\r\n        if ((<VideoTexture>texture).video) {\r\n            this._activeChannel = channel;\r\n            (<VideoTexture>texture).update();\r\n        } else if (texture.delayLoadState === 4) { // Delay loading\r\n            texture.delayLoad();\r\n            return false;\r\n        }\r\n\r\n        let internalTexture: InternalTexture;\r\n        if (depthStencilTexture) {\r\n            internalTexture = (<RenderTargetTexture>texture).depthStencilTexture!;\r\n        } else if (texture.isReady()) {\r\n            internalTexture = <InternalTexture>texture.getInternalTexture();\r\n        } else if (texture.isCube) {\r\n            internalTexture = this.emptyCubeTexture;\r\n        } else if (texture.is3D) {\r\n            internalTexture = this.emptyTexture3D;\r\n        } else if (texture.is2DArray) {\r\n            internalTexture = this.emptyTexture2DArray;\r\n        } else {\r\n            internalTexture = this.emptyTexture;\r\n        }\r\n\r\n        this._activeChannel = channel;\r\n\r\n        if (!internalTexture ||\r\n            !internalTexture._webGLTexture) {\r\n            return false;\r\n        }\r\n\r\n        this._native.setTextureWrapMode(\r\n            internalTexture._webGLTexture,\r\n            this._getAddressMode(texture.wrapU),\r\n            this._getAddressMode(texture.wrapV),\r\n            this._getAddressMode(texture.wrapR));\r\n        this._updateAnisotropicLevel(texture);\r\n\r\n        this._native.setTexture(uniform, internalTexture._webGLTexture);\r\n\r\n        return true;\r\n    }\r\n\r\n    // TODO: Share more of this logic with the base implementation.\r\n    // TODO: Rename to match naming in base implementation once refactoring allows different parameters.\r\n    private _updateAnisotropicLevel(texture: BaseTexture) {\r\n        var internalTexture = texture.getInternalTexture();\r\n        var value = texture.anisotropicFilteringLevel;\r\n\r\n        if (!internalTexture || !internalTexture._webGLTexture) {\r\n            return;\r\n        }\r\n\r\n        if (internalTexture._cachedAnisotropicFilteringLevel !== value) {\r\n            this._native.setTextureAnisotropicLevel(internalTexture._webGLTexture, value);\r\n            internalTexture._cachedAnisotropicFilteringLevel = value;\r\n        }\r\n    }\r\n\r\n    // Returns a NativeAddressMode.XXX value.\r\n    private _getAddressMode(wrapMode: number): number {\r\n        switch (wrapMode) {\r\n            case 1:\r\n                return this._native.ADDRESS_MODE_WRAP;\r\n            case 0:\r\n                return this._native.ADDRESS_MODE_CLAMP;\r\n            case 2:\r\n                return this._native.ADDRESS_MODE_MIRROR;\r\n            default:\r\n                throw new Error(\"Unexpected wrap mode: \" + wrapMode + \".\");\r\n        }\r\n    }\r\n\r\n    /** @hidden */\r\n    public _bindTexture(channel: number, texture: InternalTexture): void {\r\n        let uniform = this._boundUniforms[channel];\r\n        if (!uniform) {\r\n            return ;\r\n        }\r\n        this._native.setTexture(uniform, texture._webGLTexture);\r\n    }\r\n\r\n    protected _deleteBuffer(buffer: NativeDataBuffer): void {\r\n        if (buffer.nativeIndexBuffer) {\r\n            this._native.deleteIndexBuffer(buffer.nativeIndexBuffer);\r\n            delete buffer.nativeIndexBuffer;\r\n        }\r\n\r\n        if (buffer.nativeVertexBuffer) {\r\n            this._native.deleteVertexBuffer(buffer.nativeVertexBuffer);\r\n            delete buffer.nativeVertexBuffer;\r\n        }\r\n    }\r\n\r\n    public releaseEffects() {\r\n        // TODO\r\n    }\r\n\r\n    /** @hidden */\r\n    public _uploadCompressedDataToTextureDirectly(texture: InternalTexture, internalFormat: number, width: number, height: number, data: ArrayBufferView, faceIndex: number = 0, lod: number = 0) {\r\n        throw new Error(\"_uploadCompressedDataToTextureDirectly not implemented.\");\r\n    }\r\n\r\n    /** @hidden */\r\n    public _uploadDataToTextureDirectly(texture: InternalTexture, imageData: ArrayBufferView, faceIndex: number = 0, lod: number = 0): void {\r\n        throw new Error(\"_uploadDataToTextureDirectly not implemented.\");\r\n    }\r\n\r\n    /** @hidden */\r\n    public _uploadArrayBufferViewToTexture(texture: InternalTexture, imageData: ArrayBufferView, faceIndex: number = 0, lod: number = 0): void {\r\n        throw new Error(\"_uploadArrayBufferViewToTexture not implemented.\");\r\n    }\r\n\r\n    /** @hidden */\r\n    public _uploadImageToTexture(texture: InternalTexture, image: HTMLImageElement, faceIndex: number = 0, lod: number = 0) {\r\n        throw new Error(\"_uploadArrayBufferViewToTexture not implemented.\");\r\n    }\r\n\r\n    // JavaScript-to-Native conversion helper functions.\r\n\r\n    private _getNativeSamplingMode(samplingMode: number): number {\r\n        switch (samplingMode) {\r\n            case 1:\r\n                return this._native.TEXTURE_NEAREST_NEAREST;\r\n            case 2:\r\n                return this._native.TEXTURE_LINEAR_LINEAR;\r\n            case 3:\r\n                return this._native.TEXTURE_LINEAR_LINEAR_MIPLINEAR;\r\n            case 4:\r\n                return this._native.TEXTURE_NEAREST_NEAREST_MIPNEAREST;\r\n            case 5:\r\n                return this._native.TEXTURE_NEAREST_LINEAR_MIPNEAREST;\r\n            case 6:\r\n                return this._native.TEXTURE_NEAREST_LINEAR_MIPLINEAR;\r\n            case 7:\r\n                return this._native.TEXTURE_NEAREST_LINEAR;\r\n            case 8:\r\n                return this._native.TEXTURE_NEAREST_NEAREST_MIPLINEAR;\r\n            case 9:\r\n                return this._native.TEXTURE_LINEAR_NEAREST_MIPNEAREST;\r\n            case 10:\r\n                return this._native.TEXTURE_LINEAR_NEAREST_MIPLINEAR;\r\n            case 11:\r\n                return this._native.TEXTURE_LINEAR_LINEAR_MIPNEAREST;\r\n            case 12:\r\n                return this._native.TEXTURE_LINEAR_NEAREST;\r\n            default:\r\n                throw new Error(`Unsupported sampling mode: ${samplingMode}.`);\r\n        }\r\n    }\r\n\r\n    private _getNativeTextureFormat(format: number, type: number): number {\r\n        if (format == 5 && type == 0) {\r\n            return this._native.TEXTURE_FORMAT_RGBA8;\r\n        }\r\n        else if (format == 5 && type == 1) {\r\n            return this._native.TEXTURE_FORMAT_RGBA32F;\r\n        }\r\n        else {\r\n            throw new Error(`Unsupported texture format or type: format ${format}, type ${type}.`);\r\n        }\r\n    }\r\n\r\n    private _getNativeAlphaMode(mode: number): number {\r\n        switch (mode) {\r\n            case 0:\r\n                return this._native.ALPHA_DISABLE;\r\n            case 1:\r\n                return this._native.ALPHA_ADD;\r\n            case 2:\r\n                return this._native.ALPHA_COMBINE;\r\n            case 3:\r\n                return this._native.ALPHA_SUBTRACT;\r\n            case 4:\r\n                return this._native.ALPHA_MULTIPLY;\r\n            case 5:\r\n                return this._native.ALPHA_MAXIMIZED;\r\n            case 6:\r\n                return this._native.ALPHA_ONEONE;\r\n            case 7:\r\n                return this._native.ALPHA_PREMULTIPLIED;\r\n            case 8:\r\n                return this._native.ALPHA_PREMULTIPLIED_PORTERDUFF;\r\n            case 9:\r\n                return this._native.ALPHA_INTERPOLATE;\r\n            case 10:\r\n                return this._native.ALPHA_SCREENMODE;\r\n            default:\r\n                throw new Error(`Unsupported alpha mode: ${mode}.`);\r\n        }\r\n    }\r\n\r\n    private _getNativeAttribType(type: number): number {\r\n        switch (type) {\r\n            case VertexBuffer.UNSIGNED_BYTE:\r\n                return this._native.ATTRIB_TYPE_UINT8;\r\n            case VertexBuffer.SHORT:\r\n                return this._native.ATTRIB_TYPE_INT16;\r\n            case VertexBuffer.FLOAT:\r\n                return this._native.ATTRIB_TYPE_FLOAT;\r\n            default:\r\n                throw new Error(`Unsupported attribute type: ${type}.`);\r\n        }\r\n    }\r\n}\r\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}