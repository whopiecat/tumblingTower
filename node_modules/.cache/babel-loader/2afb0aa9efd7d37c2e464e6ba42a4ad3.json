{"ast":null,"code":"import { __decorate, __extends } from \"tslib\";\nimport { NodeMaterialBlock } from '../nodeMaterialBlock';\nimport { NodeMaterialBlockConnectionPointTypes } from '../Enums/nodeMaterialBlockConnectionPointTypes';\nimport { NodeMaterialBlockTargets } from '../Enums/nodeMaterialBlockTargets';\nimport { _TypeStore } from '../../../Misc/typeStore';\nimport { editableInPropertyPage, PropertyTypeForEdition } from \"../nodeMaterialDecorator\";\n/**\r\n * block used to Generate a Worley Noise 3D Noise Pattern\r\n */\n//  Source: https://github.com/Erkaman/glsl-worley\n//  Converted to BJS by Pryme8\n//\n//  Worley Noise 3D\n//  Return vec2 value range of -1.0->1.0, F1-F2 respectivly\n\nvar WorleyNoise3DBlock =\n/** @class */\nfunction (_super) {\n  __extends(WorleyNoise3DBlock, _super);\n  /**\r\n   * Creates a new WorleyNoise3DBlock\r\n   * @param name defines the block name\r\n   */\n\n\n  function WorleyNoise3DBlock(name) {\n    var _this = _super.call(this, name, NodeMaterialBlockTargets.Neutral) || this;\n    /** Gets or sets a boolean indicating that normal should be inverted on X axis */\n\n\n    _this.manhattanDistance = false;\n\n    _this.registerInput(\"seed\", NodeMaterialBlockConnectionPointTypes.Vector3);\n\n    _this.registerInput(\"jitter\", NodeMaterialBlockConnectionPointTypes.Float);\n\n    _this.registerOutput(\"output\", NodeMaterialBlockConnectionPointTypes.Vector2);\n\n    return _this;\n  }\n  /**\r\n   * Gets the current class name\r\n   * @returns the class name\r\n   */\n\n\n  WorleyNoise3DBlock.prototype.getClassName = function () {\n    return \"WorleyNoise3DBlock\";\n  };\n\n  Object.defineProperty(WorleyNoise3DBlock.prototype, \"seed\", {\n    /**\r\n     * Gets the seed input component\r\n     */\n    get: function () {\n      return this._inputs[0];\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(WorleyNoise3DBlock.prototype, \"jitter\", {\n    /**\r\n     * Gets the jitter input component\r\n     */\n    get: function () {\n      return this._inputs[1];\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(WorleyNoise3DBlock.prototype, \"output\", {\n    /**\r\n     * Gets the output component\r\n     */\n    get: function () {\n      return this._outputs[0];\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  WorleyNoise3DBlock.prototype._buildBlock = function (state) {\n    _super.prototype._buildBlock.call(this, state);\n\n    if (!this.seed.isConnected) {\n      return;\n    }\n\n    if (!this._outputs[0].hasEndpoints) {\n      return;\n    }\n\n    var functionString = \"vec3 permute(vec3 x){\\r\\n\";\n    functionString += \"    return mod((34.0 * x + 1.0) * x, 289.0);\\r\\n\";\n    functionString += \"}\\r\\n\\r\\n\";\n    functionString += \"vec3 dist(vec3 x, vec3 y, vec3 z,  bool manhattanDistance){\\r\\n\";\n    functionString += \"    return manhattanDistance ?  abs(x) + abs(y) + abs(z) :  (x * x + y * y + z * z);\\r\\n\";\n    functionString += \"}\\r\\n\\r\\n\";\n    functionString += \"vec2 worley(vec3 P, float jitter, bool manhattanDistance){\\r\\n\";\n    functionString += \"    float K = 0.142857142857; // 1/7\\r\\n\";\n    functionString += \"    float Ko = 0.428571428571; // 1/2-K/2\\r\\n\";\n    functionString += \"    float  K2 = 0.020408163265306; // 1/(7*7)\\r\\n\";\n    functionString += \"    float Kz = 0.166666666667; // 1/6\\r\\n\";\n    functionString += \"    float Kzo = 0.416666666667; // 1/2-1/6*2\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 Pi = mod(floor(P), 289.0);\\r\\n\";\n    functionString += \"    vec3 Pf = fract(P) - 0.5;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 Pfx = Pf.x + vec3(1.0, 0.0, -1.0);\\r\\n\";\n    functionString += \"    vec3 Pfy = Pf.y + vec3(1.0, 0.0, -1.0);\\r\\n\";\n    functionString += \"    vec3 Pfz = Pf.z + vec3(1.0, 0.0, -1.0);\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 p = permute(Pi.x + vec3(-1.0, 0.0, 1.0));\\r\\n\";\n    functionString += \"    vec3 p1 = permute(p + Pi.y - 1.0);\\r\\n\";\n    functionString += \"    vec3 p2 = permute(p + Pi.y);\\r\\n\";\n    functionString += \"    vec3 p3 = permute(p + Pi.y + 1.0);\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 p11 = permute(p1 + Pi.z - 1.0);\\r\\n\";\n    functionString += \"    vec3 p12 = permute(p1 + Pi.z);\\r\\n\";\n    functionString += \"    vec3 p13 = permute(p1 + Pi.z + 1.0);\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 p21 = permute(p2 + Pi.z - 1.0);\\r\\n\";\n    functionString += \"    vec3 p22 = permute(p2 + Pi.z);\\r\\n\";\n    functionString += \"    vec3 p23 = permute(p2 + Pi.z + 1.0);\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 p31 = permute(p3 + Pi.z - 1.0);\\r\\n\";\n    functionString += \"    vec3 p32 = permute(p3 + Pi.z);\\r\\n\";\n    functionString += \"    vec3 p33 = permute(p3 + Pi.z + 1.0);\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 ox11 = fract(p11*K) - Ko;\\r\\n\";\n    functionString += \"    vec3 oy11 = mod(floor(p11*K), 7.0)*K - Ko;\\r\\n\";\n    functionString += \"    vec3 oz11 = floor(p11*K2)*Kz - Kzo; // p11 < 289 guaranteed\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 ox12 = fract(p12*K) - Ko;\\r\\n\";\n    functionString += \"    vec3 oy12 = mod(floor(p12*K), 7.0)*K - Ko;\\r\\n\";\n    functionString += \"    vec3 oz12 = floor(p12*K2)*Kz - Kzo;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 ox13 = fract(p13*K) - Ko;\\r\\n\";\n    functionString += \"    vec3 oy13 = mod(floor(p13*K), 7.0)*K - Ko;\\r\\n\";\n    functionString += \"    vec3 oz13 = floor(p13*K2)*Kz - Kzo;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 ox21 = fract(p21*K) - Ko;\\r\\n\";\n    functionString += \"    vec3 oy21 = mod(floor(p21*K), 7.0)*K - Ko;\\r\\n\";\n    functionString += \"    vec3 oz21 = floor(p21*K2)*Kz - Kzo;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 ox22 = fract(p22*K) - Ko;\\r\\n\";\n    functionString += \"    vec3 oy22 = mod(floor(p22*K), 7.0)*K - Ko;\\r\\n\";\n    functionString += \"    vec3 oz22 = floor(p22*K2)*Kz - Kzo;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 ox23 = fract(p23*K) - Ko;\\r\\n\";\n    functionString += \"    vec3 oy23 = mod(floor(p23*K), 7.0)*K - Ko;\\r\\n\";\n    functionString += \"    vec3 oz23 = floor(p23*K2)*Kz - Kzo;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 ox31 = fract(p31*K) - Ko;\\r\\n\";\n    functionString += \"    vec3 oy31 = mod(floor(p31*K), 7.0)*K - Ko;\\r\\n\";\n    functionString += \"    vec3 oz31 = floor(p31*K2)*Kz - Kzo;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 ox32 = fract(p32*K) - Ko;\\r\\n\";\n    functionString += \"    vec3 oy32 = mod(floor(p32*K), 7.0)*K - Ko;\\r\\n\";\n    functionString += \"    vec3 oz32 = floor(p32*K2)*Kz - Kzo;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 ox33 = fract(p33*K) - Ko;\\r\\n\";\n    functionString += \"    vec3 oy33 = mod(floor(p33*K), 7.0)*K - Ko;\\r\\n\";\n    functionString += \"    vec3 oz33 = floor(p33*K2)*Kz - Kzo;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 dx11 = Pfx + jitter*ox11;\\r\\n\";\n    functionString += \"    vec3 dy11 = Pfy.x + jitter*oy11;\\r\\n\";\n    functionString += \"    vec3 dz11 = Pfz.x + jitter*oz11;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 dx12 = Pfx + jitter*ox12;\\r\\n\";\n    functionString += \"    vec3 dy12 = Pfy.x + jitter*oy12;\\r\\n\";\n    functionString += \"    vec3 dz12 = Pfz.y + jitter*oz12;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 dx13 = Pfx + jitter*ox13;\\r\\n\";\n    functionString += \"    vec3 dy13 = Pfy.x + jitter*oy13;\\r\\n\";\n    functionString += \"    vec3 dz13 = Pfz.z + jitter*oz13;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 dx21 = Pfx + jitter*ox21;\\r\\n\";\n    functionString += \"    vec3 dy21 = Pfy.y + jitter*oy21;\\r\\n\";\n    functionString += \"    vec3 dz21 = Pfz.x + jitter*oz21;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 dx22 = Pfx + jitter*ox22;\\r\\n\";\n    functionString += \"    vec3 dy22 = Pfy.y + jitter*oy22;\\r\\n\";\n    functionString += \"    vec3 dz22 = Pfz.y + jitter*oz22;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 dx23 = Pfx + jitter*ox23;\\r\\n\";\n    functionString += \"    vec3 dy23 = Pfy.y + jitter*oy23;\\r\\n\";\n    functionString += \"    vec3 dz23 = Pfz.z + jitter*oz23;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 dx31 = Pfx + jitter*ox31;\\r\\n\";\n    functionString += \"    vec3 dy31 = Pfy.z + jitter*oy31;\\r\\n\";\n    functionString += \"    vec3 dz31 = Pfz.x + jitter*oz31;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 dx32 = Pfx + jitter*ox32;\\r\\n\";\n    functionString += \"    vec3 dy32 = Pfy.z + jitter*oy32;\\r\\n\";\n    functionString += \"    vec3 dz32 = Pfz.y + jitter*oz32;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 dx33 = Pfx + jitter*ox33;\\r\\n\";\n    functionString += \"    vec3 dy33 = Pfy.z + jitter*oy33;\\r\\n\";\n    functionString += \"    vec3 dz33 = Pfz.z + jitter*oz33;\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 d11 = dist(dx11, dy11, dz11, manhattanDistance);\\r\\n\";\n    functionString += \"    vec3 d12 =dist(dx12, dy12, dz12, manhattanDistance);\\r\\n\";\n    functionString += \"    vec3 d13 = dist(dx13, dy13, dz13, manhattanDistance);\\r\\n\";\n    functionString += \"    vec3 d21 = dist(dx21, dy21, dz21, manhattanDistance);\\r\\n\";\n    functionString += \"    vec3 d22 = dist(dx22, dy22, dz22, manhattanDistance);\\r\\n\";\n    functionString += \"    vec3 d23 = dist(dx23, dy23, dz23, manhattanDistance);\\r\\n\";\n    functionString += \"    vec3 d31 = dist(dx31, dy31, dz31, manhattanDistance);\\r\\n\";\n    functionString += \"    vec3 d32 = dist(dx32, dy32, dz32, manhattanDistance);\\r\\n\";\n    functionString += \"    vec3 d33 = dist(dx33, dy33, dz33, manhattanDistance);\\r\\n\";\n    functionString += \"\\r\\n\";\n    functionString += \"    vec3 d1a = min(d11, d12);\\r\\n\";\n    functionString += \"    d12 = max(d11, d12);\\r\\n\";\n    functionString += \"    d11 = min(d1a, d13); // Smallest now not in d12 or d13\\r\\n\";\n    functionString += \"    d13 = max(d1a, d13);\\r\\n\";\n    functionString += \"    d12 = min(d12, d13); // 2nd smallest now not in d13\\r\\n\";\n    functionString += \"    vec3 d2a = min(d21, d22);\\r\\n\";\n    functionString += \"    d22 = max(d21, d22);\\r\\n\";\n    functionString += \"    d21 = min(d2a, d23); // Smallest now not in d22 or d23\\r\\n\";\n    functionString += \"    d23 = max(d2a, d23);\\r\\n\";\n    functionString += \"    d22 = min(d22, d23); // 2nd smallest now not in d23\\r\\n\";\n    functionString += \"    vec3 d3a = min(d31, d32);\\r\\n\";\n    functionString += \"    d32 = max(d31, d32);\\r\\n\";\n    functionString += \"    d31 = min(d3a, d33); // Smallest now not in d32 or d33\\r\\n\";\n    functionString += \"    d33 = max(d3a, d33);\\r\\n\";\n    functionString += \"    d32 = min(d32, d33); // 2nd smallest now not in d33\\r\\n\";\n    functionString += \"    vec3 da = min(d11, d21);\\r\\n\";\n    functionString += \"    d21 = max(d11, d21);\\r\\n\";\n    functionString += \"    d11 = min(da, d31); // Smallest now in d11\\r\\n\";\n    functionString += \"    d31 = max(da, d31); // 2nd smallest now not in d31\\r\\n\";\n    functionString += \"    d11.xy = (d11.x < d11.y) ? d11.xy : d11.yx;\\r\\n\";\n    functionString += \"    d11.xz = (d11.x < d11.z) ? d11.xz : d11.zx; // d11.x now smallest\\r\\n\";\n    functionString += \"    d12 = min(d12, d21); // 2nd smallest now not in d21\\r\\n\";\n    functionString += \"    d12 = min(d12, d22); // nor in d22\\r\\n\";\n    functionString += \"    d12 = min(d12, d31); // nor in d31\\r\\n\";\n    functionString += \"    d12 = min(d12, d32); // nor in d32\\r\\n\";\n    functionString += \"    d11.yz = min(d11.yz,d12.xy); // nor in d12.yz\\r\\n\";\n    functionString += \"    d11.y = min(d11.y,d12.z); // Only two more to go\\r\\n\";\n    functionString += \"    d11.y = min(d11.y,d11.z); // Done! (Phew!)\\r\\n\";\n    functionString += \"    return sqrt(d11.xy); // F1, F2\\r\\n\";\n    functionString += \"}\\r\\n\\r\\n\";\n\n    state._emitFunction('worley3D', functionString, '// Worley3D');\n\n    state.compilationString += this._declareOutput(this._outputs[0], state) + (\" = worley(\" + this.seed.associatedVariableName + \", \" + this.jitter.associatedVariableName + \", \" + this.manhattanDistance + \");\\r\\n\");\n    return this;\n  };\n  /**\r\n   * Exposes the properties to the UI?\r\n   */\n\n\n  WorleyNoise3DBlock.prototype._dumpPropertiesCode = function () {\n    var codeString = this._codeVariableName + \".manhattanDistance = \" + this.manhattanDistance + \";\\r\\n\";\n    return codeString;\n  };\n  /**\r\n   * Exposes the properties to the Seralize?\r\n   */\n\n\n  WorleyNoise3DBlock.prototype.serialize = function () {\n    var serializationObject = _super.prototype.serialize.call(this);\n\n    serializationObject.manhattanDistance = this.manhattanDistance;\n    return serializationObject;\n  };\n  /**\r\n   * Exposes the properties to the deseralize?\r\n   */\n\n\n  WorleyNoise3DBlock.prototype._deserialize = function (serializationObject, scene, rootUrl) {\n    _super.prototype._deserialize.call(this, serializationObject, scene, rootUrl);\n\n    this.manhattanDistance = serializationObject.manhattanDistance;\n  };\n\n  __decorate([editableInPropertyPage(\"Use Manhattan Distance\", PropertyTypeForEdition.Boolean, \"PROPERTIES\", {\n    \"notifiers\": {\n      \"update\": false\n    }\n  })], WorleyNoise3DBlock.prototype, \"manhattanDistance\", void 0);\n\n  return WorleyNoise3DBlock;\n}(NodeMaterialBlock);\n\nexport { WorleyNoise3DBlock };\n_TypeStore.RegisteredTypes[\"BABYLON.WorleyNoise3DBlock\"] = WorleyNoise3DBlock;","map":{"version":3,"sources":["../../../../../sourceES6/core/Materials/Node/Blocks/worleyNoise3DBlock.ts"],"names":[],"mappings":"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","sourcesContent":["import { NodeMaterialBlock } from '../nodeMaterialBlock';\r\nimport { NodeMaterialBlockConnectionPointTypes } from '../Enums/nodeMaterialBlockConnectionPointTypes';\r\nimport { NodeMaterialBuildState } from '../nodeMaterialBuildState';\r\nimport { NodeMaterialConnectionPoint } from '../nodeMaterialBlockConnectionPoint';\r\nimport { NodeMaterialBlockTargets } from '../Enums/nodeMaterialBlockTargets';\r\nimport { _TypeStore } from '../../../Misc/typeStore';\r\nimport { Scene } from '../../../scene';\r\nimport { editableInPropertyPage, PropertyTypeForEdition } from \"../nodeMaterialDecorator\";\r\n\r\n/**\r\n * block used to Generate a Worley Noise 3D Noise Pattern\r\n */\r\n\r\n//  Source: https://github.com/Erkaman/glsl-worley\r\n//  Converted to BJS by Pryme8\r\n//\r\n//  Worley Noise 3D\r\n//  Return vec2 value range of -1.0->1.0, F1-F2 respectivly\r\n\r\nexport class WorleyNoise3DBlock extends NodeMaterialBlock {\r\n    /** Gets or sets a boolean indicating that normal should be inverted on X axis */\r\n    @editableInPropertyPage(\"Use Manhattan Distance\", PropertyTypeForEdition.Boolean, \"PROPERTIES\", { \"notifiers\": { \"update\": false }})\r\n    public manhattanDistance = false;\r\n\r\n    /**\r\n     * Creates a new WorleyNoise3DBlock\r\n     * @param name defines the block name\r\n     */\r\n    public constructor(name: string) {\r\n        super(name, NodeMaterialBlockTargets.Neutral);\r\n        this.registerInput(\"seed\", NodeMaterialBlockConnectionPointTypes.Vector3);\r\n        this.registerInput(\"jitter\", NodeMaterialBlockConnectionPointTypes.Float);\r\n\r\n        this.registerOutput(\"output\", NodeMaterialBlockConnectionPointTypes.Vector2);\r\n    }\r\n\r\n    /**\r\n     * Gets the current class name\r\n     * @returns the class name\r\n     */\r\n    public getClassName() {\r\n        return \"WorleyNoise3DBlock\";\r\n    }\r\n\r\n    /**\r\n     * Gets the seed input component\r\n     */\r\n    public get seed(): NodeMaterialConnectionPoint {\r\n        return this._inputs[0];\r\n    }\r\n\r\n    /**\r\n     * Gets the jitter input component\r\n     */\r\n    public get jitter(): NodeMaterialConnectionPoint {\r\n        return this._inputs[1];\r\n    }\r\n\r\n    /**\r\n     * Gets the output component\r\n     */\r\n    public get output(): NodeMaterialConnectionPoint {\r\n        return this._outputs[0];\r\n    }\r\n\r\n    protected _buildBlock(state: NodeMaterialBuildState) {\r\n        super._buildBlock(state);\r\n\r\n        if (!this.seed.isConnected) {\r\n            return;\r\n        }\r\n\r\n        if (!this._outputs[0].hasEndpoints) {\r\n            return;\r\n        }\r\n\r\n        let functionString = `vec3 permute(vec3 x){\\r\\n`;\r\n        functionString += `    return mod((34.0 * x + 1.0) * x, 289.0);\\r\\n`;\r\n        functionString += `}\\r\\n\\r\\n`;\r\n\r\n        functionString += `vec3 dist(vec3 x, vec3 y, vec3 z,  bool manhattanDistance){\\r\\n`;\r\n        functionString += `    return manhattanDistance ?  abs(x) + abs(y) + abs(z) :  (x * x + y * y + z * z);\\r\\n`;\r\n        functionString += `}\\r\\n\\r\\n`;\r\n\r\n        functionString += `vec2 worley(vec3 P, float jitter, bool manhattanDistance){\\r\\n`;\r\n        functionString += `    float K = 0.142857142857; // 1/7\\r\\n`;\r\n        functionString += `    float Ko = 0.428571428571; // 1/2-K/2\\r\\n`;\r\n        functionString += `    float  K2 = 0.020408163265306; // 1/(7*7)\\r\\n`;\r\n        functionString += `    float Kz = 0.166666666667; // 1/6\\r\\n`;\r\n        functionString += `    float Kzo = 0.416666666667; // 1/2-1/6*2\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 Pi = mod(floor(P), 289.0);\\r\\n`;\r\n        functionString += `    vec3 Pf = fract(P) - 0.5;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 Pfx = Pf.x + vec3(1.0, 0.0, -1.0);\\r\\n`;\r\n        functionString += `    vec3 Pfy = Pf.y + vec3(1.0, 0.0, -1.0);\\r\\n`;\r\n        functionString += `    vec3 Pfz = Pf.z + vec3(1.0, 0.0, -1.0);\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 p = permute(Pi.x + vec3(-1.0, 0.0, 1.0));\\r\\n`;\r\n        functionString += `    vec3 p1 = permute(p + Pi.y - 1.0);\\r\\n`;\r\n        functionString += `    vec3 p2 = permute(p + Pi.y);\\r\\n`;\r\n        functionString += `    vec3 p3 = permute(p + Pi.y + 1.0);\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 p11 = permute(p1 + Pi.z - 1.0);\\r\\n`;\r\n        functionString += `    vec3 p12 = permute(p1 + Pi.z);\\r\\n`;\r\n        functionString += `    vec3 p13 = permute(p1 + Pi.z + 1.0);\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 p21 = permute(p2 + Pi.z - 1.0);\\r\\n`;\r\n        functionString += `    vec3 p22 = permute(p2 + Pi.z);\\r\\n`;\r\n        functionString += `    vec3 p23 = permute(p2 + Pi.z + 1.0);\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 p31 = permute(p3 + Pi.z - 1.0);\\r\\n`;\r\n        functionString += `    vec3 p32 = permute(p3 + Pi.z);\\r\\n`;\r\n        functionString += `    vec3 p33 = permute(p3 + Pi.z + 1.0);\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 ox11 = fract(p11*K) - Ko;\\r\\n`;\r\n        functionString += `    vec3 oy11 = mod(floor(p11*K), 7.0)*K - Ko;\\r\\n`;\r\n        functionString += `    vec3 oz11 = floor(p11*K2)*Kz - Kzo; // p11 < 289 guaranteed\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 ox12 = fract(p12*K) - Ko;\\r\\n`;\r\n        functionString += `    vec3 oy12 = mod(floor(p12*K), 7.0)*K - Ko;\\r\\n`;\r\n        functionString += `    vec3 oz12 = floor(p12*K2)*Kz - Kzo;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 ox13 = fract(p13*K) - Ko;\\r\\n`;\r\n        functionString += `    vec3 oy13 = mod(floor(p13*K), 7.0)*K - Ko;\\r\\n`;\r\n        functionString += `    vec3 oz13 = floor(p13*K2)*Kz - Kzo;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 ox21 = fract(p21*K) - Ko;\\r\\n`;\r\n        functionString += `    vec3 oy21 = mod(floor(p21*K), 7.0)*K - Ko;\\r\\n`;\r\n        functionString += `    vec3 oz21 = floor(p21*K2)*Kz - Kzo;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 ox22 = fract(p22*K) - Ko;\\r\\n`;\r\n        functionString += `    vec3 oy22 = mod(floor(p22*K), 7.0)*K - Ko;\\r\\n`;\r\n        functionString += `    vec3 oz22 = floor(p22*K2)*Kz - Kzo;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 ox23 = fract(p23*K) - Ko;\\r\\n`;\r\n        functionString += `    vec3 oy23 = mod(floor(p23*K), 7.0)*K - Ko;\\r\\n`;\r\n        functionString += `    vec3 oz23 = floor(p23*K2)*Kz - Kzo;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 ox31 = fract(p31*K) - Ko;\\r\\n`;\r\n        functionString += `    vec3 oy31 = mod(floor(p31*K), 7.0)*K - Ko;\\r\\n`;\r\n        functionString += `    vec3 oz31 = floor(p31*K2)*Kz - Kzo;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 ox32 = fract(p32*K) - Ko;\\r\\n`;\r\n        functionString += `    vec3 oy32 = mod(floor(p32*K), 7.0)*K - Ko;\\r\\n`;\r\n        functionString += `    vec3 oz32 = floor(p32*K2)*Kz - Kzo;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 ox33 = fract(p33*K) - Ko;\\r\\n`;\r\n        functionString += `    vec3 oy33 = mod(floor(p33*K), 7.0)*K - Ko;\\r\\n`;\r\n        functionString += `    vec3 oz33 = floor(p33*K2)*Kz - Kzo;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 dx11 = Pfx + jitter*ox11;\\r\\n`;\r\n        functionString += `    vec3 dy11 = Pfy.x + jitter*oy11;\\r\\n`;\r\n        functionString += `    vec3 dz11 = Pfz.x + jitter*oz11;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 dx12 = Pfx + jitter*ox12;\\r\\n`;\r\n        functionString += `    vec3 dy12 = Pfy.x + jitter*oy12;\\r\\n`;\r\n        functionString += `    vec3 dz12 = Pfz.y + jitter*oz12;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 dx13 = Pfx + jitter*ox13;\\r\\n`;\r\n        functionString += `    vec3 dy13 = Pfy.x + jitter*oy13;\\r\\n`;\r\n        functionString += `    vec3 dz13 = Pfz.z + jitter*oz13;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 dx21 = Pfx + jitter*ox21;\\r\\n`;\r\n        functionString += `    vec3 dy21 = Pfy.y + jitter*oy21;\\r\\n`;\r\n        functionString += `    vec3 dz21 = Pfz.x + jitter*oz21;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 dx22 = Pfx + jitter*ox22;\\r\\n`;\r\n        functionString += `    vec3 dy22 = Pfy.y + jitter*oy22;\\r\\n`;\r\n        functionString += `    vec3 dz22 = Pfz.y + jitter*oz22;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 dx23 = Pfx + jitter*ox23;\\r\\n`;\r\n        functionString += `    vec3 dy23 = Pfy.y + jitter*oy23;\\r\\n`;\r\n        functionString += `    vec3 dz23 = Pfz.z + jitter*oz23;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 dx31 = Pfx + jitter*ox31;\\r\\n`;\r\n        functionString += `    vec3 dy31 = Pfy.z + jitter*oy31;\\r\\n`;\r\n        functionString += `    vec3 dz31 = Pfz.x + jitter*oz31;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 dx32 = Pfx + jitter*ox32;\\r\\n`;\r\n        functionString += `    vec3 dy32 = Pfy.z + jitter*oy32;\\r\\n`;\r\n        functionString += `    vec3 dz32 = Pfz.y + jitter*oz32;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 dx33 = Pfx + jitter*ox33;\\r\\n`;\r\n        functionString += `    vec3 dy33 = Pfy.z + jitter*oy33;\\r\\n`;\r\n        functionString += `    vec3 dz33 = Pfz.z + jitter*oz33;\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 d11 = dist(dx11, dy11, dz11, manhattanDistance);\\r\\n`;\r\n        functionString += `    vec3 d12 =dist(dx12, dy12, dz12, manhattanDistance);\\r\\n`;\r\n        functionString += `    vec3 d13 = dist(dx13, dy13, dz13, manhattanDistance);\\r\\n`;\r\n        functionString += `    vec3 d21 = dist(dx21, dy21, dz21, manhattanDistance);\\r\\n`;\r\n        functionString += `    vec3 d22 = dist(dx22, dy22, dz22, manhattanDistance);\\r\\n`;\r\n        functionString += `    vec3 d23 = dist(dx23, dy23, dz23, manhattanDistance);\\r\\n`;\r\n        functionString += `    vec3 d31 = dist(dx31, dy31, dz31, manhattanDistance);\\r\\n`;\r\n        functionString += `    vec3 d32 = dist(dx32, dy32, dz32, manhattanDistance);\\r\\n`;\r\n        functionString += `    vec3 d33 = dist(dx33, dy33, dz33, manhattanDistance);\\r\\n`;\r\n        functionString += `\\r\\n`;\r\n        functionString += `    vec3 d1a = min(d11, d12);\\r\\n`;\r\n        functionString += `    d12 = max(d11, d12);\\r\\n`;\r\n        functionString += `    d11 = min(d1a, d13); // Smallest now not in d12 or d13\\r\\n`;\r\n        functionString += `    d13 = max(d1a, d13);\\r\\n`;\r\n        functionString += `    d12 = min(d12, d13); // 2nd smallest now not in d13\\r\\n`;\r\n        functionString += `    vec3 d2a = min(d21, d22);\\r\\n`;\r\n        functionString += `    d22 = max(d21, d22);\\r\\n`;\r\n        functionString += `    d21 = min(d2a, d23); // Smallest now not in d22 or d23\\r\\n`;\r\n        functionString += `    d23 = max(d2a, d23);\\r\\n`;\r\n        functionString += `    d22 = min(d22, d23); // 2nd smallest now not in d23\\r\\n`;\r\n        functionString += `    vec3 d3a = min(d31, d32);\\r\\n`;\r\n        functionString += `    d32 = max(d31, d32);\\r\\n`;\r\n        functionString += `    d31 = min(d3a, d33); // Smallest now not in d32 or d33\\r\\n`;\r\n        functionString += `    d33 = max(d3a, d33);\\r\\n`;\r\n        functionString += `    d32 = min(d32, d33); // 2nd smallest now not in d33\\r\\n`;\r\n        functionString += `    vec3 da = min(d11, d21);\\r\\n`;\r\n        functionString += `    d21 = max(d11, d21);\\r\\n`;\r\n        functionString += `    d11 = min(da, d31); // Smallest now in d11\\r\\n`;\r\n        functionString += `    d31 = max(da, d31); // 2nd smallest now not in d31\\r\\n`;\r\n        functionString += `    d11.xy = (d11.x < d11.y) ? d11.xy : d11.yx;\\r\\n`;\r\n        functionString += `    d11.xz = (d11.x < d11.z) ? d11.xz : d11.zx; // d11.x now smallest\\r\\n`;\r\n        functionString += `    d12 = min(d12, d21); // 2nd smallest now not in d21\\r\\n`;\r\n        functionString += `    d12 = min(d12, d22); // nor in d22\\r\\n`;\r\n        functionString += `    d12 = min(d12, d31); // nor in d31\\r\\n`;\r\n        functionString += `    d12 = min(d12, d32); // nor in d32\\r\\n`;\r\n        functionString += `    d11.yz = min(d11.yz,d12.xy); // nor in d12.yz\\r\\n`;\r\n        functionString += `    d11.y = min(d11.y,d12.z); // Only two more to go\\r\\n`;\r\n        functionString += `    d11.y = min(d11.y,d11.z); // Done! (Phew!)\\r\\n`;\r\n        functionString += `    return sqrt(d11.xy); // F1, F2\\r\\n`;\r\n        functionString += `}\\r\\n\\r\\n`;\r\n\r\n        state._emitFunction('worley3D', functionString, '// Worley3D');\r\n        state.compilationString += this._declareOutput(this._outputs[0], state) + ` = worley(${this.seed.associatedVariableName}, ${this.jitter.associatedVariableName}, ${this.manhattanDistance});\\r\\n`;\r\n\r\n        return this;\r\n    }\r\n    /**\r\n     * Exposes the properties to the UI?\r\n     */\r\n    protected _dumpPropertiesCode() {\r\n        var codeString = `${this._codeVariableName}.manhattanDistance = ${this.manhattanDistance};\\r\\n`;\r\n\r\n        return codeString;\r\n    }\r\n    /**\r\n     * Exposes the properties to the Seralize?\r\n     */\r\n    public serialize(): any {\r\n        let serializationObject = super.serialize();\r\n\r\n        serializationObject.manhattanDistance = this.manhattanDistance;\r\n\r\n        return serializationObject;\r\n    }\r\n    /**\r\n     * Exposes the properties to the deseralize?\r\n     */\r\n    public _deserialize(serializationObject: any, scene: Scene, rootUrl: string) {\r\n        super._deserialize(serializationObject, scene, rootUrl);\r\n\r\n        this.manhattanDistance = serializationObject.manhattanDistance;\r\n    }\r\n}\r\n\r\n_TypeStore.RegisteredTypes[\"BABYLON.WorleyNoise3DBlock\"] = WorleyNoise3DBlock;"],"sourceRoot":""},"metadata":{},"sourceType":"module"}